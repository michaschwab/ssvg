{"version":3,"sources":["webpack://SSVG/webpack/universalModuleDefinition","webpack://SSVG/webpack/bootstrap","webpack://SSVG/./canvasworker/drawingUtils.ts","webpack://SSVG/./frontend/exporter.ts","webpack://SSVG/./frontend/ssvg.ts","webpack://SSVG/./frontend/domhandler.ts","webpack://SSVG/./util/vdom/vdom-manager.ts","webpack://SSVG/./canvasworker/canvasrenderer.ts","webpack://SSVG/./canvasworker/index.ts","webpack://SSVG/./canvasworker/canvasworker.ts","webpack://SSVG/./node_modules/worker-loader/dist/workers/InlineWorker.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","DrawingUtils","transform","transformObject","translateX","translateY","scaleX","scaleY","rotate","translateBeforeScale","transformString","replace","translate","exec","parseFloat","scale","substr","matrix","transformA","transformB","size","fallback","defaultValue","undefined","Math","round","parseInt","match","console","warn","color","opacity","defaultColor","CssNamedColorToHex","test","substring","length","join","Error","g","b","rgb","hslToRgb","h","hue2rgb","q","COLOR_HEXES","toUpperCase","selector","specificity","parts","concat","apply","split","map","part","start","countClasses","min","ALICEBLUE","ANTIQUEWHITE","AQUA","AQUAMARINE","AZURE","BEIGE","BISQUE","BLACK","BLANCHEDALMOND","BLUE","BLUEVIOLET","BROWN","BURLYWOOD","CADETBLUE","CHARTREUSE","CHOCOLATE","CORAL","CORNFLOWERBLUE","CORNSILK","CRIMSON","CYAN","DARKBLUE","DARKCYAN","DARKGOLDENROD","DARKGRAY","DARKGREY","DARKGREEN","DARKKHAKI","DARKMAGENTA","DARKOLIVEGREEN","DARKORANGE","DARKORCHID","DARKRED","DARKSALMON","DARKSEAGREEN","DARKSLATEBLUE","DARKSLATEGRAY","DARKSLATEGREY","DARKTURQUOISE","DARKVIOLET","DEEPPINK","DEEPSKYBLUE","DIMGRAY","DIMGREY","DODGERBLUE","FIREBRICK","FLORALWHITE","FORESTGREEN","FUCHSIA","GAINSBORO","GHOSTWHITE","GOLD","GOLDENROD","GRAY","GREY","GREEN","GREENYELLOW","HONEYDEW","HOTPINK","INDIANRED","INDIGO","IVORY","KHAKI","LAVENDER","LAVENDERBLUSH","LAWNGREEN","LEMONCHIFFON","LIGHTBLUE","LIGHTCORAL","LIGHTCYAN","LIGHTGOLDENRODYELLOW","LIGHTGRAY","LIGHTGREY","LIGHTGREEN","LIGHTPINK","LIGHTSALMON","LIGHTSEAGREEN","LIGHTSKYBLUE","LIGHTSLATEGRAY","LIGHTSLATEGREY","LIGHTSTEELBLUE","LIGHTYELLOW","LIME","LIMEGREEN","LINEN","MAGENTA","MAROON","MEDIUMAQUAMARINE","MEDIUMBLUE","MEDIUMORCHID","MEDIUMPURPLE","MEDIUMSEAGREEN","MEDIUMSLATEBLUE","MEDIUMSPRINGGREEN","MEDIUMTURQUOISE","MEDIUMVIOLETRED","MIDNIGHTBLUE","MINTCREAM","MISTYROSE","MOCCASIN","NAVAJOWHITE","NAVY","OLDLACE","OLIVE","OLIVEDRAB","ORANGE","ORANGERED","ORCHID","PALEGOLDENROD","PALEGREEN","PALETURQUOISE","PALEVIOLETRED","PAPAYAWHIP","PEACHPUFF","PERU","PINK","PLUM","POWDERBLUE","PURPLE","REBECCAPURPLE","RED","ROSYBROWN","ROYALBLUE","SADDLEBROWN","SALMON","SANDYBROWN","SEAGREEN","SEASHELL","SIENNA","SILVER","SKYBLUE","SLATEBLUE","SLATEGRAY","SLATEGREY","SNOW","SPRINGGREEN","STEELBLUE","TAN","TEAL","THISTLE","TOMATO","TURQUOISE","VIOLET","WHEAT","WHITE","WHITESMOKE","YELLOW","YELLOWGREEN","SSVG","options","unassignedNodes","interactionSelections","svgAssignedAndSizeSet","lastCanvasDrawTimes","enterExitQueue","safeMode","useWorker","getFps","this","maxPixelRatio","canvas","document","createElement","worker","onmessage","e","data","msg","logDrawn","requestAnimationFrame","updateCanvas","raf","updateFps","captureD3On","svg","setupElementsIfSvgExists","addEventListener","propagateMouseEvent","propagateTouchEvent","lastHovered","hoveredElement","dispatchEvent","MouseEvent","duplicateTouchEvent","propagateWheelEvent","replaceNativeRemoveChild","replaceNativeAttribute","replaceNativePathFunctions","replaceNativeCreateElement","replaceNativeAppendChild","replaceD3Attr","replaceNativeSelect","replaceNativeGetComputedStyle","replaceD3Select","replaceD3Remove","setTimeout","log","vdom","svgEl","getElementsByTagName","urlConnector","location","href","indexOf","svgSwitchUrl","svgSwitchComment","createComment","parent","parentElement","nextSibling","next","insertBefore","appendChild","domHandler","getVDom","setCanvasSize","useAttrQueue","queue","sendUpdateToWorker","renderer","updatePropertiesFromQueue","draw","width","height","devicePixelRatio","style","offscreen","transferControlToOffscreen","sendToWorker","cmd","visData","ensureNodesMapped","element","isWithinSvg","parentEl","parentNode","d3","originalOn","selection","on","me","el","_parents","children","push","arguments","getReplacement","original","elements","_groups","filter","safeLog","childElements","node","getVisNode","childNodes","getVisNodesFromSelector","getElementFromNode","returnValue","forEach","childNode","childEl","selectAll","select","origFilter","selectorString","firstElement","getNodeFromElement","nodes","selectors","sel","trim","filteredNodes","matchingNodes","filterNodesBySelector","filteredElements","origGetComputedStyle","getComputedStyle","getPropertyValue","propertyName","origQuerySelector","Element","querySelector","globalElementIndex","originalFct","prefix","els","returnVal","getAttributeFromSelector","keys","getElementSelector","error","getVisNodeFromSelector","child","queueSetAttributeOnElement","queueSetAttributeOnSelection","origSelectionAttr","attr","origSelectionStyle","originalClassed","classed","className","enableFrontendDesignProperties","indexOfParent","childIndex","parentSelector","getParentNodeFromSelector","prevClassNames","evaluatedValue","__data__","newClassNames","originalTransition","transition","originalText","text","newRemove","getNewRemoveChild","d3Remove","updateChildSelectors","remove","origCreate","createElementNS","newArgs","Array","from","getNewAppendChild","childElement","nodesToElements","oldSelector","combineElementSelectors","type","updateNodeSelector","origRemoveChild","skipUpdateSelectors","writable","parentGlobalIndex","removeNodeFromParent","removeChild","origAppend","appended","el2","keepChildren","getNodeDataFromEl","setProperty","styleProp","removeProperty","linkNodeToElement","addNodeToParent","restyleNode","addNode","index","splice","origAppendChild","newAppend","newChild","refChild","origGetTotalLength","SVGPathElement","getTotalLength","getAttribute","origSetAttribute","origSetAttr","setAttribute","origSetAttrNS","setAttributeNS","origGetAttr","evt","propagateEvent","createEvent","initEvent","prop","touches","touch","identifier","pageX","pageY","clientX","clientY","WheelEvent","new_event","triggeredElement","x","y","getMousePosition","interactionSel","j","vdomNode","nodeAtPosition","svgChildEl","event","pos","visNode","cx","cy","parseTransform","sqrt","pow","elX","elY","centerX","centerY","distanceX","abs","distanceY","getTotalTransformation","matchAny","Date","now","shift","timeForTenDrawsMs","fps","enterExit","update","postMessage","safeLogCount","logContents","CSS_STYLES","ignoreDesign","nodesToRestyle","globalElementIndexCounter","logged","styleSpecificity","VdomManager","display","addChildNodesToVisData","attrName","ensureInitialized","set","longSpecName","fetch","origin","then","resp","blob","createImageBitmap","bitmap","styleName","useSharedArray","self","ensureElementIndex","cb","applyStyles","getQueue","clearQueue","getNodeFromIndex","roundedAttrs","tagName","toLowerCase","textContent","attributes","nodeValue","nodeName","kebabCase","obj","propNames","getOwnPropertyNames","propName","clean","styleSheets","sheet","rules","cssRules","rule","selectorText","applyRuleToMatchingNodes","newSelector","selectorPartsLooseStrict","parentsOfInterest","nodeToBeStyled","getNodeParent","getCssRuleSpecificityNumber","setStyle","longName","setValue","getQueueValue","checkNode","currentNode","looseIndex","strictIndex","selPart","isCssRulePartialMatch","removedClass","getNodeSelector","removeRuleStylesFromNode","colorToRgba","removeNode","childEls","localName","elementType","nodeIndex","getParentNode","parents","pop","totalTransform","addTransforms","sharedData","useSharedArrayFor","indexToNodeMap","cachedListSelections","useBuffer","numNodes","newLength","newByteLength","Int32Array","BYTES_PER_ELEMENT","byteLength","buffer","SharedArrayBuffer","values","oldVals","BUFFER_PRECISION_FACTOR","storage","addToMap","nodeData","parentNodeIndex","applyParentStyles","styleValue","applyStyleToNodeAndChildren","id","filtered","setAttrQueue","attrNameStart","IGNOREDESIGN_ATTRIBUTES","specificityAttrName","matchingSpecificity","updateDeducedStyles","ROUNDED_ATTRS","stroke","strokeOpacity","lastSplitPos","lastIndexOf","selectorWithoutLast","lastPart","parentSel","nthChildPosition","selectedNodes","findMatchingChildren","addDirectChildrenIfMatch","matchIndex","selectedNodeSelectors","selParts","findChildrenOfType","matching","cssRuleSelectorPart","newSelPart","searchClassNames","allTrue","searchClassName","indexPart","targetIndex","cutoff","typeName","forceSingle","onDrawn","parentValues","lastFullSecond","countSinceLastFullSecond","circlesByColor","rectsByColor","drawTexts","drawImages","linesByColor","ctx","getContext","save","restore","clearRect","drawLine","drawCircle","drawRect","drawText","drawImage","drawNodeAndChildren","fullSecond","performance","elData","drawClip","parentValuesBackup","applyTransform","clipPathId","clipNode","getNodeById","path","Path2D","clip","safeErrorLog","drawSingleNode","fill","getFillStyle","getStrokeStyle","drawFct","handle","beginPath","fillStyle","strokeStyle","lineWidth","getStrokeWidth","moveTo","arc","PI","fillAndStrokeColor","fillColor","strokeColor","sampleData","defaultCol","fillRect","rect","isClip","drawSingle","fontFamily","fontSize","convertSizeToPx","font","align","textAlign","dx","dy","fillText","image","strokeWidth","lineJoin","addPath","textAnchor","lineTo","CanvasWorkerImporter","URL","webkitURL","content","url","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","MSBlobBuilder","append","getBlob","Blob","Worker","createObjectURL","encodeURIComponent"],"mappings":"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","file":"ssvg.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SSVG\"] = factory();\n\telse\n\t\troot[\"SSVG\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export type Transformation = {\n    translateX: number,\n    translateY: number,\n    scaleX: number,\n    scaleY: number,\n    rotate: number,\n    translateBeforeScale: boolean\n}\n\nexport default class DrawingUtils {\n    static parseTransform(transform: string|{}): Transformation {\n        const transformObject = {translateX: 0, translateY: 0, scaleX: 1, scaleY: 1, rotate: 0, translateBeforeScale: false};\n        \n        if (transform) {\n            if(typeof transform !== \"string\") {\n                transformObject.scaleX = transform['k'];\n                transformObject.scaleY = transform['k'];\n                transformObject.translateX = transform['x'];\n                transformObject.translateY = transform['y'];\n                return transformObject;\n            }\n            let transformString = <string> transform;\n            transformString = transformString.replace(/ /g, '');\n            \n            //let translate  = /translate\\((\\d+),(\\d+)\\)/.exec(transform);\n            const translate = /\\s*translate\\(([-0-9.]+),([-0-9.]+)\\)/.exec(transformString);\n            if (translate) {\n                transformObject.translateX = parseFloat(translate[1]);\n                transformObject.translateY = parseFloat(translate[2]);\n            }\n            else {\n                //console.error('no translate found', transform);\n            }\n            \n            const scale = /\\s*scale\\(([-0-9.]+)(,[-0-9.]+)?\\)/.exec(transformString);\n            if (scale) {\n                transformObject.scaleX = parseFloat(scale[1]);\n                transformObject.scaleY = scale[2] ? parseFloat(scale[2].substr(1)) : parseFloat(scale[1]);\n            }\n            else {\n                //console.error('no scale found', transform);\n            }\n            \n            const rotate = /\\s*rotate\\(([-0-9.]+)\\)/.exec(transformString);\n            if (rotate) {\n                transformObject.rotate = parseFloat(rotate[1]);\n            }\n            else {\n                //console.error('no rotate found', transform);\n            }\n            \n            const translateScale = /\\s*translate\\(([-0-9.]+),([-0-9.]+)\\)scale\\(([-0-9.,]+)\\)/.exec(transformString);\n            if (translateScale) {\n                transformObject.translateBeforeScale = true;\n            }\n            \n            const matrix = /\\s*matrix\\(([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+)\\)/.exec(transformString);\n            if(matrix) {\n                transformObject.scaleX = parseFloat(matrix[1]);\n                // 2 is horizontal skewing\n                // 3 is vertical skewing\n                transformObject.scaleY = parseFloat(matrix[4]);\n                transformObject.translateX = parseFloat(matrix[5]);\n                transformObject.translateY = parseFloat(matrix[6]);\n            }\n        }\n        \n        return transformObject;\n    }\n\n    static addTransforms(transformA: Transformation, transformB: Transformation): Transformation {\n        return {\n            translateX: transformA.translateX + transformB.translateX,\n            translateY: transformA.translateY + transformB.translateY,\n            scaleX: transformA.scaleX * transformB.scaleX,\n            scaleY: transformA.scaleY * transformB.scaleY,\n            rotate: transformA.rotate + transformB.rotate,\n            translateBeforeScale: false\n        };\n        //TODO: consider translateBeforeScale\n    }\n\n    static convertSizeToPx(size: string|number, fallback = true): number|undefined {\n        const defaultValue = fallback ? 14 : undefined;\n        if(size === undefined) {\n            return defaultValue;\n        }\n        if(typeof size === \"number\") {\n            return size;\n        }\n        if(size.substr(-2) === 'em') {\n            return Math.round(parseFloat(size) * 12);\n        }\n        if(size.substr(-2) === 'px') {\n            return parseInt(size);\n        }\n        if(size.match(/^[0-9]+$/)) {\n            return parseInt(size);\n        }\n        console.warn('size in unsupported format: ', size);\n        return defaultValue;\n    }\n    \n    static colorToRgba(color: string|{r: number, g: number, b: number}|{h: number, s: number, l: number},\n                       opacity: string|number = 1,\n                       defaultColor ='none'): string {\n        if(color === 'none') {\n            return color;\n        }\n        if(!color) {\n            color = defaultColor;\n        }\n        color = DrawingUtils.CssNamedColorToHex(color);\n        if(opacity === 1 && typeof color === 'string') {\n            return color;\n        }\n        if(typeof color === 'string' && color[0] === '#') {\n            let c; // From https://stackoverflow.com/questions/21646738/convert-hex-to-rgba\n            if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(color)){\n                c = color.substring(1);\n                if(c.length == 3){\n                    c = c[0] + c[0] + c[1] + c[1] + c[2] + c[2];\n                }\n                c = '0x' + c;\n                return 'rgba('+[(c>>16)&255, (c>>8)&255, c&255].join(',')+',' + opacity + ')';\n            }\n            throw new Error('Bad Hex');\n        } else if(typeof color === 'object') {\n            if('r' in color) {\n                return 'rgba(' + color.r + ',' + color.g + ',' + color.b + ',' + opacity + ')';\n            }\n            if('h' in color) {\n                const rgb = DrawingUtils.hslToRgb(color.h / 360, color.s, color.l);\n                return 'rgba(' + rgb.r + ',' + rgb.g + ',' + rgb.b + ',' + opacity + ')';\n            }\n        } else if(color.substr(0, 4) === 'rgb(') {\n            return color.substr(0, color.length - 1).replace('rgb','rgba') +\n                ', ' + opacity + ')';\n        }\n        return color;\n    }\n\n    // From https://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion\n    static hslToRgb(h, s, l) {\n        var r, g, b;\n\n        if(s == 0){\n            r = g = b = l; // achromatic\n        } else {\n            var hue2rgb = function hue2rgb(p, q, t){\n                if(t < 0) t += 1;\n                if(t > 1) t -= 1;\n                if(t < 1/6) return p + (q - p) * 6 * t;\n                if(t < 1/2) return q;\n                if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n                return p;\n            };\n\n            var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n            var p = 2 * l - q;\n            r = hue2rgb(p, q, h + 1/3);\n            g = hue2rgb(p, q, h);\n            b = hue2rgb(p, q, h - 1/3);\n        }\n\n        return {r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255)};\n    }\n\n    static CssNamedColorToHex(color: any) {\n        if(typeof color === 'string' && COLOR_HEXES[color.toUpperCase()]) {\n            return COLOR_HEXES[color.toUpperCase()];\n        }\n        return color;\n    }\n\n    /**\n     * Basic implementation to get a sense of specificity. Numbers are completely made up.\n     * Should eventually be more sophisticated, e.g. using https://github.com/keeganstreet/specificity.\n     * @param selector CSS rule as string.\n     */\n    static getCssRuleSpecificityNumber(selector: string) {\n        let specificity = 0;\n\n        selector = selector\n            .replace(/ >/g, '>')\n            .replace(/> /g, '>');\n\n        const parts = [].concat.apply([], selector.split(' ')\n            .map(part => part.split('>')));\n\n        // Rough logic: the more stuff, the more specific. IDs and classes are more specific than other things.\n        for(const part of parts) {\n            specificity += 100;\n            const start = part[0];\n\n            if(start === '#') {\n                specificity += 1000;\n            } else if(start === '.') {\n                // More classes are more specific, but never more specific than an ID.\n                const countClasses = part.split('.').length - 1;\n                specificity += Math.min(900, countClasses * 100);\n            }\n        }\n\n        return specificity;\n    }\n}\n\nconst COLOR_HEXES = {\n    ALICEBLUE: '#F0F8FF',\n    ANTIQUEWHITE: '#FAEBD7',\n    AQUA: '#00FFFF',\n    AQUAMARINE: '#7FFFD4',\n    AZURE: '#F0FFFF',\n    BEIGE: '#F5F5DC',\n    BISQUE: '#FFE4C4',\n    BLACK: '#000000',\n    BLANCHEDALMOND: '#FFEBCD',\n    BLUE: '#0000FF',\n    BLUEVIOLET: '#8A2BE2',\n    BROWN: '#A52A2A',\n    BURLYWOOD: '#DEB887',\n    CADETBLUE: '#5F9EA0',\n    CHARTREUSE: '#7FFF00',\n    CHOCOLATE: '#D2691E',\n    CORAL: '#FF7F50',\n    CORNFLOWERBLUE: '#6495ED',\n    CORNSILK: '#FFF8DC',\n    CRIMSON: '#DC143C',\n    CYAN: '#00FFFF',\n    DARKBLUE: '#00008B',\n    DARKCYAN: '#008B8B',\n    DARKGOLDENROD: '#B8860B',\n    DARKGRAY: '#A9A9A9',\n    DARKGREY: '#A9A9A9',\n    DARKGREEN: '#006400',\n    DARKKHAKI: '#BDB76B',\n    DARKMAGENTA: '#8B008B',\n    DARKOLIVEGREEN: '#556B2F',\n    DARKORANGE: '#FF8C00',\n    DARKORCHID: '#9932CC',\n    DARKRED: '#8B0000',\n    DARKSALMON: '#E9967A',\n    DARKSEAGREEN: '#8FBC8F',\n    DARKSLATEBLUE: '#483D8B',\n    DARKSLATEGRAY: '#2F4F4F',\n    DARKSLATEGREY: '#2F4F4F',\n    DARKTURQUOISE: '#00CED1',\n    DARKVIOLET: '#9400D3',\n    DEEPPINK: '#FF1493',\n    DEEPSKYBLUE: '#00BFFF',\n    DIMGRAY: '#696969',\n    DIMGREY: '#696969',\n    DODGERBLUE: '#1E90FF',\n    FIREBRICK: '#B22222',\n    FLORALWHITE: '#FFFAF0',\n    FORESTGREEN: '#228B22',\n    FUCHSIA: '#FF00FF',\n    GAINSBORO: '#DCDCDC',\n    GHOSTWHITE: '#F8F8FF',\n    GOLD: '#FFD700',\n    GOLDENROD: '#DAA520',\n    GRAY: '#808080',\n    GREY: '#808080',\n    GREEN: '#008000',\n    GREENYELLOW: '#ADFF2F',\n    HONEYDEW: '#F0FFF0',\n    HOTPINK: '#FF69B4',\n    INDIANRED: '#CD5C5C',\n    INDIGO: '#4B0082',\n    IVORY: '#FFFFF0',\n    KHAKI: '#F0E68C',\n    LAVENDER: '#E6E6FA',\n    LAVENDERBLUSH: '#FFF0F5',\n    LAWNGREEN: '#7CFC00',\n    LEMONCHIFFON: '#FFFACD',\n    LIGHTBLUE: '#ADD8E6',\n    LIGHTCORAL: '#F08080',\n    LIGHTCYAN: '#E0FFFF',\n    LIGHTGOLDENRODYELLOW: '#FAFAD2',\n    LIGHTGRAY: '#D3D3D3',\n    LIGHTGREY: '#D3D3D3',\n    LIGHTGREEN: '#90EE90',\n    LIGHTPINK: '#FFB6C1',\n    LIGHTSALMON: '#FFA07A',\n    LIGHTSEAGREEN: '#20B2AA',\n    LIGHTSKYBLUE: '#87CEFA',\n    LIGHTSLATEGRAY: '#778899',\n    LIGHTSLATEGREY: '#778899',\n    LIGHTSTEELBLUE: '#B0C4DE',\n    LIGHTYELLOW: '#FFFFE0',\n    LIME: '#00FF00',\n    LIMEGREEN: '#32CD32',\n    LINEN: '#FAF0E6',\n    MAGENTA: '#FF00FF',\n    MAROON: '#800000',\n    MEDIUMAQUAMARINE: '#66CDAA',\n    MEDIUMBLUE: '#0000CD',\n    MEDIUMORCHID: '#BA55D3',\n    MEDIUMPURPLE: '#9370DB',\n    MEDIUMSEAGREEN: '#3CB371',\n    MEDIUMSLATEBLUE: '#7B68EE',\n    MEDIUMSPRINGGREEN: '#00FA9A',\n    MEDIUMTURQUOISE: '#48D1CC',\n    MEDIUMVIOLETRED: '#C71585',\n    MIDNIGHTBLUE: '#191970',\n    MINTCREAM: '#F5FFFA',\n    MISTYROSE: '#FFE4E1',\n    MOCCASIN: '#FFE4B5',\n    NAVAJOWHITE: '#FFDEAD',\n    NAVY: '#000080',\n    OLDLACE: '#FDF5E6',\n    OLIVE: '#808000',\n    OLIVEDRAB: '#6B8E23',\n    ORANGE: '#FFA500',\n    ORANGERED: '#FF4500',\n    ORCHID: '#DA70D6',\n    PALEGOLDENROD: '#EEE8AA',\n    PALEGREEN: '#98FB98',\n    PALETURQUOISE: '#AFEEEE',\n    PALEVIOLETRED: '#DB7093',\n    PAPAYAWHIP: '#FFEFD5',\n    PEACHPUFF: '#FFDAB9',\n    PERU: '#CD853F',\n    PINK: '#FFC0CB',\n    PLUM: '#DDA0DD',\n    POWDERBLUE: '#B0E0E6',\n    PURPLE: '#800080',\n    REBECCAPURPLE: '#663399',\n    RED: '#FF0000',\n    ROSYBROWN: '#BC8F8F',\n    ROYALBLUE: '#4169E1',\n    SADDLEBROWN: '#8B4513',\n    SALMON: '#FA8072',\n    SANDYBROWN: '#F4A460',\n    SEAGREEN: '#2E8B57',\n    SEASHELL: '#FFF5EE',\n    SIENNA: '#A0522D',\n    SILVER: '#C0C0C0',\n    SKYBLUE: '#87CEEB',\n    SLATEBLUE: '#6A5ACD',\n    SLATEGRAY: '#708090',\n    SLATEGREY: '#708090',\n    SNOW: '#FFFAFA',\n    SPRINGGREEN: '#00FF7F',\n    STEELBLUE: '#4682B4',\n    TAN: '#D2B48C',\n    TEAL: '#008080',\n    THISTLE: '#D8BFD8',\n    TOMATO: '#FF6347',\n    TURQUOISE: '#40E0D0',\n    VIOLET: '#EE82EE',\n    WHEAT: '#F5DEB3',\n    WHITE: '#FFFFFF',\n    WHITESMOKE: '#F5F5F5',\n    YELLOW: '#FFFF00',\n    YELLOWGREEN: '#9ACD32'\n};\n\n","import SSVG from \"./ssvg\";\n\nexport = SSVG;","import {VdomManager} from \"../util/vdom/vdom-manager\";\nimport {VdomNode} from \"../util/vdom/vdom\";\nimport {CanvasWorkerMessage, CanvasUpdateWorkerMessage, CanvasUpdateData} from \"../util/canvas-worker-message\"\nimport Domhandler, {SsvgElement} from \"./domhandler\";\nimport CanvasWorker from \"../canvasworker/canvasworker\";\nimport Canvasrenderer from \"../canvasworker/canvasrenderer\";\nimport DrawingUtils from \"../canvasworker/drawingUtils\";\nimport CanvasWorkerImporter from '../canvasworker';\n\nexport default class SSVG {\n    private unassignedNodes: Node[] = [];\n    private worker: Worker;\n    private domHandler: Domhandler;\n    private vdom: VdomManager;\n    private interactionSelections: SsvgElement[] = [];\n    \n    private renderer: CanvasWorker;\n\n    private svg: (SVGElement & SsvgElement)|undefined;\n    private readonly canvas: HTMLCanvasElement;\n    private svgAssignedAndSizeSet = false;\n    \n    private lastCanvasDrawTimes: number[] = [];\n    \n    private enterExitQueue: CanvasUpdateData[] = [];\n\n    private readonly safeMode: boolean = false;\n    private readonly maxPixelRatio: number|undefined;\n    private readonly useWorker: boolean = true;\n    private readonly getFps: (fps: number) => void = () => {};\n\n    private hoveredElement: Element|undefined;\n\n    constructor(options?: {\n        safeMode?: boolean,\n        maxPixelRatio?: number,\n        useWorker?: boolean,\n        getFps?: (fps: number) => void,\n        svg?: SVGElement & SsvgElement,\n    }) {\n        if(options) {\n            if(options.safeMode !== undefined) {\n                this.safeMode = options.safeMode;\n            }\n            this.maxPixelRatio = options.maxPixelRatio;\n            if(options.useWorker !== undefined) {\n                this.useWorker = options.useWorker;\n            }\n            if(options.getFps !== undefined) {\n                this.getFps = options.getFps;\n            }\n        }\n\n        this.canvas = document.createElement('canvas');\n        if(!('OffscreenCanvas' in window)) {\n            this.useWorker = false;\n        }\n        \n        if(this.useWorker) {\n            this.worker = new CanvasWorkerImporter();\n    \n            this.worker.onmessage = e => {\n                if(e.data && e.data.msg && e.data.msg === 'DRAWN') {\n                    this.logDrawn();\n                    requestAnimationFrame(() => this.updateCanvas());\n                }\n            };\n            const raf = () => {\n                this.updateFps();\n                requestAnimationFrame(raf);\n            };\n            raf();\n        } else {\n            const raf = () => {\n                this.updateFps();\n                this.logDrawn();\n                this.updateCanvas();\n                requestAnimationFrame(raf);\n            };\n            raf();\n        }\n\n        this.captureD3On();\n        const svg = options && options.svg ? options.svg : undefined;\n        this.setupElementsIfSvgExists(svg);\n        \n        this.canvas.addEventListener('mousedown', e => this.propagateMouseEvent(e));\n        this.canvas.addEventListener('touchstart', e => this.propagateTouchEvent(e));\n        this.canvas.addEventListener('mousemove', e => {\n            const lastHovered = this.hoveredElement;\n            this.hoveredElement = this.propagateMouseEvent(e);\n            if(lastHovered !== this.hoveredElement) {\n                if(lastHovered) {\n                    lastHovered.dispatchEvent(new MouseEvent('mouseout', e));\n                }\n            }\n            this.propagateMouseEvent(e, 'mouseover');\n        });\n        this.canvas.addEventListener('touchmove', e => {\n            const lastHovered = this.hoveredElement;\n            this.hoveredElement = this.propagateTouchEvent(e);\n            if(lastHovered !== this.hoveredElement) {\n                if(lastHovered) {\n                    lastHovered.dispatchEvent(this.duplicateTouchEvent(e, 'mouseout'));\n                }\n            }\n            this.propagateTouchEvent(e, 'mouseover');\n        });\n        this.canvas.addEventListener('mouseup', e => this.propagateMouseEvent(e));\n        this.canvas.addEventListener('touchend', e => this.propagateTouchEvent(e));\n        this.canvas.addEventListener('click', e => this.propagateMouseEvent(e));\n        this.canvas.addEventListener('wheel', e => this.propagateWheelEvent(e));\n\n        this.replaceNativeRemoveChild();\n        this.replaceNativeAttribute();\n        this.replaceNativePathFunctions();\n        this.replaceNativeCreateElement();\n        this.replaceNativeAppendChild();\n        this.replaceD3Attr();\n        this.replaceNativeSelect();\n        this.replaceNativeGetComputedStyle();\n        this.replaceD3Select();\n        this.replaceD3Remove();\n\n        setTimeout(() => {\n            console.log(this.vdom.data);\n        }, 1000);\n    }\n    \n    private setupElementsIfSvgExists(svgEl?: SVGElement & SsvgElement) {\n        \n        if(this.svg) {\n            return true;\n        }\n\n        const svg = !svgEl ? document.getElementsByTagName('svg')[0] : svgEl;\n        \n        if(!svg) {\n            return false;\n        }\n\n        const urlConnector = document.location.href.indexOf('?') === -1 ? '?' : '&';\n        const svgSwitchUrl = document.location.href + urlConnector + 'svg';\n        const svgSwitchComment = document.createComment(' This project uses SSVG.io to render a SVG as Canvas.\\r\\n' +\n            'To inspect the SVG, please open the following URL:\\r\\n' +\n            svgSwitchUrl + '\\r\\n');\n        \n        this.svg = svg as SVGElement & SsvgElement;\n        const parent = this.svg.parentElement;\n\n        if(this.svg.nextSibling) {\n            const next = this.svg.nextSibling;\n            parent.insertBefore(svgSwitchComment, next);\n            parent.insertBefore(this.canvas, next);\n        } else {\n            parent.appendChild(svgSwitchComment);\n            parent.appendChild(this.canvas);\n        }\n\n        this.domHandler = new Domhandler(this.svg, this.useWorker, this.useWorker);\n        this.vdom = this.domHandler.getVDom();\n\n        this.setCanvasSize();\n        \n        return true;\n    }\n    \n    private updateCanvas() {\n        if(!this.svgAssignedAndSizeSet) {\n            return;\n        }\n        if(this.useWorker) {\n            this.domHandler.useAttrQueue(queue => {\n                /*if(Object.keys(queue).length === 0) {\n                    //requestAnimationFrame(() => this.updateCanvas());\n                    setTimeout(() => this.updateCanvas(), 1);\n                    //console.log('nothing new');\n                    return;\n                }*/\n\n                /*for(let operation of this.enterExitQueue) {\n                    if(operation.cmd === 'ENTER') {\n                        if(!operation.keepChildren) {\n                            operation.node.children = [];\n                        }\n                        this.vdom.addNode(operation.node, operation.parentNodeIndex);\n                    } else if(operation.cmd === 'EXIT') {\n                        this.vdom.removeNode(operation.childIndex, operation.parentNodeSelector);\n                    }\n                }*/\n                this.sendUpdateToWorker(queue);\n            });\n        } else {\n            this.domHandler.useAttrQueue(queue => {\n                if(this.renderer.updatePropertiesFromQueue) {\n                    this.renderer.updatePropertiesFromQueue(queue);\n                }\n                this.renderer.draw();\n            });\n        }\n    }\n    \n    private setCanvasSize() {\n        if(!this.svg || !this.vdom.data.width || !this.vdom.data.height) {\n            return;\n        }\n        this.vdom.data.scale = window.devicePixelRatio;\n        if(this.maxPixelRatio !== undefined && this.vdom.data.scale > this.maxPixelRatio) {\n            this.vdom.data.scale = this.maxPixelRatio;\n        }\n    \n        this.canvas.style.width = this.vdom.data.width + 'px';\n        this.canvas.style.height = this.vdom.data.height + 'px';\n        this.canvas.width = this.vdom.data.width * this.vdom.data.scale;\n        this.canvas.height = this.vdom.data.height * this.vdom.data.scale;\n        \n        if(this.useWorker) {\n            const offscreen = (this.canvas as any).transferControlToOffscreen();\n            this.sendToWorker({cmd: 'INIT', data: {\n                    canvas: offscreen,\n                    visData: this.vdom.data,\n                    safeMode: this.safeMode\n                }\n            }, [offscreen]);\n            this.vdom.ensureNodesMapped();\n        } else {\n            this.renderer = new Canvasrenderer(this.vdom, this.canvas, this.safeMode, () => {});\n        }\n        \n        this.svgAssignedAndSizeSet = true;\n    }\n\n    private isWithinSvg(element: Element) {\n        let isWithinSvg = false;\n        let parentEl = element;\n\n        while(parentEl && parentEl.parentNode) {\n            if(parentEl === this.svg) {\n                isWithinSvg = true;\n            }\n            parentEl = <Element> parentEl.parentNode;\n        }\n        return isWithinSvg;\n    }\n    \n    private captureD3On() {\n        if((window as any)['d3']) {\n            const d3 = (window as any)['d3'];\n            const originalOn = d3.selection.prototype.on;\n            const me = this;\n\n            d3.selection.prototype.on = function()\n            {\n                let el = this._parents && this._parents.length ? this._parents[0] : this[0].parentNode;\n                if(el === document.children[0]) {\n                    el = me.svg;\n                }\n                let isWithinSvg = me.isWithinSvg(el);\n\n                if(el && isWithinSvg && me.interactionSelections.indexOf(el) === -1)\n                {\n                    me.interactionSelections.push(el); // This one works for native get/setAttribute\n                    //interactionSelections.push(this); // This one works for d3 .attr.\n                }\n        \n                return originalOn.apply(this, arguments);\n            };\n        }\n    }\n    \n    private replaceD3Select() {\n        if((window as any)['d3']) {\n            const me = this;\n            const d3 = (window as any)['d3'];\n\n            const getReplacement = (original) => {\n                return function(selector: string|(()=>{})) {\n                    if(typeof selector === 'string') {\n                        if(selector === 'body') {\n                            return original.apply(this, arguments);\n                        }\n                        let elements: SsvgElement[];\n                        if(this === d3) {\n                            elements = [me.svg];\n                        } else {\n                            elements = this._groups ? this._groups[0] : this[0];\n                        }\n\n                        if(!elements.filter(e => e).length) {\n                            safeLog('element not found within svg, using normal execution', this, selector);\n                            return original.apply(this, arguments);\n                        }\n\n                        let childElements: SsvgElement[] = [];\n\n                        for(let i = 0; i < elements.length; i++) {\n                            const element = elements[i];\n                            const node = me.domHandler.getVisNode(element);\n\n                            if(!node) {\n                                console.warn('node not found', element);\n                                return original.apply(this, arguments);\n                            }\n\n                            const childNodes = me.vdom.getVisNodesFromSelector(node, selector);\n                            childElements = childElements.concat(childNodes.map(node => {\n                                return me.domHandler.getElementFromNode(node);\n                            }));\n                        }\n\n                        const returnValue = original.apply(this, arguments);\n                        const elementsOutsideSvg: NodeList = returnValue._groups ? returnValue._groups[0]\n                            : returnValue[0];\n                        elementsOutsideSvg.forEach(childNode => {\n                            const childEl = <SsvgElement> <any> childNode;\n                            if(childElements.indexOf(childEl) === -1) {\n                                childElements.push();\n                            }\n                        });\n\n                        if(returnValue._groups) {\n                            returnValue._groups[0] = childElements;\n                        } else {\n                            // Older d3 versions\n                            const parentNode = returnValue[0].parentNode;\n                            returnValue[0] = childElements;\n                            returnValue[0].parentNode = parentNode;\n                        }\n\n                        return returnValue;\n                    }\n\n                    return original.apply(this, arguments);\n                }\n            };\n\n            d3.selection.prototype.selectAll = getReplacement(d3.selection.prototype.selectAll);\n            d3.selectAll = getReplacement(d3.selectAll);\n            d3.selection.prototype.select = getReplacement(d3.selection.prototype.select);\n            d3.select = getReplacement(d3.select);\n\n            const origFilter = d3.selection.prototype.filter;\n            d3.selection.prototype.filter = function(selectorString: string) {\n                const elements = this._groups ? this._groups[0] : this[0];\n                if(typeof selectorString !== 'string') {\n                    return origFilter.apply(this, arguments);\n                }\n                let firstElement = elements[0];\n                let i = 1;\n                while(!firstElement && i < elements.length) {\n                    i++;\n                    firstElement = elements[i];\n                }\n\n                const parentNode = firstElement ? me.domHandler.getNodeFromElement(firstElement.parentNode) : null;\n                const nodes = elements.map(element => me.domHandler.getNodeFromElement(element));\n\n                const selectors = selectorString.split(',').map(sel => sel.trim());\n                const filteredNodes = [];\n\n                for(const selector of selectors) {\n                    const matchingNodes = me.vdom.filterNodesBySelector(parentNode, nodes, selector);\n\n                    for(const node of matchingNodes) {\n                        if(filteredNodes.indexOf(node) === -1) {\n                            filteredNodes.push(node);\n                        }\n                    }\n                }\n\n                const filteredElements = filteredNodes.map(node => me.domHandler.getElementFromNode(node));\n\n                const returnValue = origFilter.apply(this, arguments);\n\n                if(returnValue._groups) {\n                    returnValue._groups[0] = filteredElements;\n                } else {\n                    // Older d3 versions\n                    const parentNode = returnValue[0].parentNode;\n                    returnValue[0] = filteredElements;\n                    returnValue[0].parentNode = parentNode;\n                }\n                return returnValue;\n            }\n        }\n    }\n\n    private replaceNativeGetComputedStyle() {\n        const origGetComputedStyle = window.getComputedStyle;\n        const me = this;\n\n        window.getComputedStyle = function(element: SsvgElement) {\n            if(element && !me.isWithinSvg(element) && (<Window> <any> element) !== window) {\n                return origGetComputedStyle.call(this, element);\n            }\n\n            const node = me.domHandler.getNodeFromElement(element);\n            if(!node) {\n                console.warn('node not found for ', this, element);\n                return origGetComputedStyle.call(this, element);\n            }\n            return {\n                getPropertyValue(propertyName: string): string {\n                    //console.log(propertyName, node, node.style[propertyName]);\n                    return node.style[propertyName];\n                }\n            } as CSSStyleDeclaration;\n        };\n    }\n\n    private replaceNativeSelect() {\n        const origQuerySelector = Element.prototype.querySelector;\n        const me = this;\n\n        Element.prototype.querySelector = function(this: SsvgElement, selector: string) {\n            if(!me.isWithinSvg(this)) {\n                return origQuerySelector.apply(this, arguments);\n            }\n\n            const node = me.domHandler.getVisNode(this);\n            const childNodes = me.vdom.getVisNodesFromSelector(node, selector);\n            if(childNodes.length === 0) {\n                console.warn('could not find selection', this, node, node.globalElementIndex, selector);\n                return null;\n            }\n            return me.domHandler.getElementFromNode(childNodes[0]);\n        };\n    }\n\n    private replaceD3Attr() {\n\n        const me = this;\n\n        function getReplacement(originalFct, prefix = '') {\n            return function(name, value) {\n                \n                if(value === undefined) {\n\n                    if(me.unassignedNodes.indexOf(this) !== -1) {\n                        return originalFct.apply(this, arguments);\n                    } else {\n                        // Dealing with d3 v3.\n                        const els = this._groups ? this._groups[0] : this[0];\n                        if(els[0] && !me.isWithinSvg(els[0])) {\n                            return originalFct.apply(this, arguments);\n                        }\n                        if(els.length > 1) {\n                            const returnVal = [];\n                            for(const el of els) {\n                                returnVal.push(me.domHandler.getAttributeFromSelector(el, name))\n                            }\n                            return returnVal;\n                        } else {\n                            return me.domHandler.getAttributeFromSelector(els[0], name);\n                        }\n                    }\n                } else {\n                    if(name === 'class' || !me.svg) {\n                        return originalFct.apply(this, arguments);\n                    }\n                    // For d3 v4, this would just be this.groups[0]. The rest is for\n                    // earlier versions, where selectAll() returned other values.\n                    let elements = this._groups ? this._groups[0] : this[0];\n\n                    if(typeof elements === 'object' && Object.keys(elements).length === 1 && elements.parentNode) {\n                        const parentElement = elements.parentNode;\n                        let parentNode: VdomNode;\n                        if(parentElement !== document.children[0]) {\n                            const selector = me.domHandler.getElementSelector(parentElement);\n                            if(selector === null) {\n                                console.error('selector not found', parentElement, elements);\n                                throw Error('selector not found');\n                            }\n                            parentNode = me.vdom.getVisNodeFromSelector(selector);\n                        } else {\n                            parentNode = me.vdom.data;\n                        }\n\n                        elements = [];\n                        for(const child of parentNode.children) {\n                            elements.push(me.domHandler.getElementFromNode(child));\n                        }\n                    }\n                    if(!elements) {\n                        return originalFct.apply(this, arguments);\n                    }\n                    const filteredElements = [];\n                    try {\n                        for (const element of elements) {\n                            if (element) {\n                                filteredElements.push(element);\n                            }\n                        }\n                    } catch(e) {\n                        console.error(elements, this);\n                        console.error(e);\n                    }\n                    if(filteredElements.length === 1) {\n                        const element = filteredElements[0];\n                        if(!element) {\n                            console.warn('element not found', this, name, value);\n                            return this;\n                        }\n                        if(!me.isWithinSvg(element)) {\n                            return originalFct.apply(this, arguments);\n                        }\n                        me.domHandler.queueSetAttributeOnElement(element, prefix + name, value);\n                    } else {\n                        if(!me.isWithinSvg(elements[0])) {\n                            return originalFct.apply(this, arguments);\n                        }\n                        me.domHandler.queueSetAttributeOnSelection(filteredElements, prefix + name, value);\n                    }\n                    \n                    if(filteredElements[0] === me.svg && (name === 'width' || name === 'height')) {\n                        me.vdom.data[name] = parseInt(value);\n                        me.setCanvasSize();\n                    }\n                \n                    return this;\n                }\n            };\n        }\n    \n        if((window as any)['d3']) {\n            const d3 = (window as any)['d3'];\n\n            const origSelectionAttr = d3.selection.prototype.attr;\n            d3.selection.prototype.attr = getReplacement(origSelectionAttr);\n\n            const origSelectionStyle = d3.selection.prototype.style;\n            d3.selection.prototype.style = getReplacement(origSelectionStyle, 'style;');\n\n            const originalClassed = d3.selection.prototype.classed;\n            d3.selection.prototype.classed = function(className: string,\n                                                      value?: boolean|((data: any, index: number) => boolean)) {\n                if(value !== undefined) {\n                    me.domHandler.enableFrontendDesignProperties();\n                    let elements = this._groups ? this._groups[0] : this[0];\n                    let i = 0;\n                    for(let element of elements) {\n                        if(element) {\n                            const indexOfParent = element.childIndex;\n                            const parentSelector = element['parentSelector'];\n                            const parent = me.vdom.getParentNodeFromSelector(parentSelector);\n                            const node = parent.children[indexOfParent];\n                            if(!node) {\n                                console.warn('node not found', element, parent, indexOfParent, className);\n                                continue;\n                            }\n                            const prevClassNames = node.className || '';\n                            const evaluatedValue = typeof value === \"function\" ? value(element.__data__, i) : value;\n                            if(evaluatedValue === true) {\n                                if(prevClassNames.indexOf(className) === -1) {\n                                    let newClassNames = (prevClassNames + ' ' + className).trim();\n\n                                    me.domHandler.queueSetAttributeOnElement(element, 'class', newClassNames);\n                                }\n                            } else if(evaluatedValue === false) {\n                                const containedPreviously = prevClassNames.indexOf(className) !== -1;\n                                if(containedPreviously) {\n                                    const newClassNames = prevClassNames.replace(className, '').replace('  ', ' ');\n                                    me.domHandler.queueSetAttributeOnElement(element, 'class', newClassNames);\n\n                                    if(!node['removedClasses']) {\n                                        node['removedClasses'] = [];\n                                    }\n                                    node['removedClasses'].push(className); // For removing associated styles.\n                                }\n                            }\n                        }\n\n                        i++;\n                    }\n                }\n                return originalClassed.apply(this, arguments);\n            };\n\n            const originalTransition = d3.selection.prototype.transition;\n            d3.selection.prototype.transition = function() {\n                me.domHandler.enableFrontendDesignProperties();\n                return originalTransition.apply(this, arguments);\n            };\n\n            const originalText = d3.selection.prototype.text;\n            d3.selection.prototype.text = function(value?: (number|string|((el: HTMLElement) => (number|string)))) {\n                if(value !== undefined) {\n                    let elements = this._groups ? this._groups[0] : this[0];\n                    let i = 0;\n                    for(let element of elements) {\n                        if(element && me.isWithinSvg(element)) {\n                            me.domHandler.queueSetAttributeOnElement(element, 'text', value);\n                        }\n\n                        i++;\n                    }\n                }\n                return originalText.apply(this, arguments);\n            };\n        }\n    }\n\n    private replaceD3Remove() {\n        if(window['d3']) {\n            const d3 = window['d3'];\n            const me = this;\n\n            const newRemove = this.getNewRemoveChild(() => {}, true);\n            const d3Remove = function() {\n                let elements = this._groups ? this._groups[0] : this[0];\n\n                //safeLog(elements, this);\n\n                if(elements.length) {\n                    let parentElement: SsvgElement = null;\n                    for(let i = elements.length - 1; i > -1; i--) {\n                        const element = elements[i];\n                        if(element) {\n                            parentElement = element.parentNode;\n                            if(!parentElement) {\n                                console.error('element has no parent node', element);\n                            }\n                            newRemove.call(parentElement, element);\n                        }\n                    }\n                    if(parentElement) {\n                        me.updateChildSelectors(parentElement);\n                    }\n                }\n                return this;\n            };\n            d3.selection.prototype.remove = d3Remove;\n            //d3.transition.prototype.remove = d3Remove;\n        }\n    }\n    \n    private replaceNativeCreateElement() {\n        const origCreate = document.createElementNS;\n        const me = this;\n        \n        document.createElementNS = function() {\n            let newArgs = Array.from(arguments);\n            const el = origCreate.apply(this, newArgs);\n            \n            /*el.appendChild = () => {\n                console.log('hi!!', el, arguments);\n                //return el;\n            };*/\n    \n            el.appendChild = me.getNewAppendChild(el.appendChild);\n            \n            me.unassignedNodes.push(el);\n    \n            //console.log(me.unassignedNodes);\n            \n            return el;\n        }\n    }\n\n    private updateChildSelectors(parentElement: SsvgElement, parentNode?: VdomNode) {\n        if(!this.isWithinSvg(parentElement)) {\n            return;\n        }\n        const parentSelector = parentElement.selector;\n        if(!parentSelector) {\n            console.error('this node has no selector', parentElement)\n        }\n        if(!parentNode) {\n            parentNode = this.vdom.getParentNodeFromSelector(parentSelector);\n        }\n        for(let i = 0; i < parentNode.children.length; i++) {\n            const childNode: VdomNode = parentNode.children[i];\n            const childElement = this.domHandler.getElementFromNode(childNode);\n            if(!childElement) {\n                console.error('element not found', childNode, parentNode.children.length, i);\n                console.log('current element indices:',\n                    this.domHandler.nodesToElements.elements.map(e => e.globalElementIndex));\n                console.log('current elements:', [...this.domHandler.nodesToElements.elements]);\n                console.log('current nodes:', [...this.domHandler.nodesToElements.nodes]);\n                console.log('parent node: ', parentNode);\n                console.log('children:', [...parentNode.children]);\n                continue;\n            }\n            const oldSelector = childElement['selector'];\n\n            childElement.childIndex = i;\n            childElement.parentSelector = parentSelector;\n            childElement.selector = this.domHandler.combineElementSelectors(parentSelector, childNode.type, i+1);\n\n            this.domHandler.updateNodeSelector(oldSelector, childElement['selector']);\n\n            this.updateChildSelectors(childElement, childNode);\n        }\n    }\n\n    private getNewRemoveChild(origRemoveChild: ((<T extends Node>(oldChild: T) => T)|(() => void)),\n        skipUpdateSelectors = false) {\n        const me = this;\n\n        return function<T extends Node>(this: SsvgElement, el: T & SsvgElement) {\n            if(!this) {\n                console.error('context not defined');\n                return el;\n            }\n            if(!me.isWithinSvg(el)) {\n                return origRemoveChild.apply(this, arguments);\n            }\n            const parentNode = me.domHandler.getNodeFromElement(this);\n            const parentSelector = this.selector;\n            const node = me.domHandler.getNodeFromElement(el);\n\n            if(!node) {\n                console.error('node not found', node, el, this, parentNode);\n                return origRemoveChild.apply(this, arguments);\n            }\n\n            // Remove all child elements.\n            /*for(const childNode of node.children) {\n                const childEl = me.domHandler.getElementFromNode(childNode);\n                el.removeChild(childEl);\n            }*/\n\n            // Remove from current parent first.\n            Object.defineProperty(el, 'parentNode', {\n                writable: true,\n                value: undefined\n            });\n\n            //console.log('remove')\n            me.enterExitQueue.push({\n                cmd: 'EXIT',\n                childIndex: el['childIndex'],\n                parentGlobalIndex: parentNode.globalElementIndex\n            });\n\n            me.domHandler.removeNodeFromParent(el, node, parentNode);\n\n            // Fix child indices of all children.\n            if(!skipUpdateSelectors) {\n                if(!parentSelector) {\n                    console.error('parent not found', parentNode, parentSelector, this, el);\n                }\n                me.updateChildSelectors(this);\n            }\n\n            delete el['selector'];\n\n            return el;\n        };\n    }\n\n    private replaceNativeRemoveChild() {\n        Element.prototype.removeChild = this.getNewRemoveChild(Element.prototype.removeChild);\n    }\n    \n    private getNewAppendChild(origAppend) {\n        const me = this;\n        \n        return function<T extends Node>(this: SsvgElement, el: T & SsvgElement) {\n            if(!me.svgAssignedAndSizeSet) {\n                if(!me.svg && el['tagName'] === 'svg') {\n                    const appended = origAppend.apply(this, arguments);\n                    me.setupElementsIfSvgExists(<SVGElement & SsvgElement> <any> el);\n                    return appended;\n                    \n                } else {\n                    return origAppend.apply(this, arguments);\n                }\n            }\n            \n            if(!me.isWithinSvg(this)) {\n                return origAppend.apply(this, arguments);\n            }\n\n            Object.defineProperty(el, 'ownerSVGElement', {\n                writable: true,\n                value: me.svg\n            });\n            el['appendChild'] = <T extends Node>(el2: T) => {\n                return me.getNewAppendChild(origAppend).call(el, el2);\n            };\n            const parentSelector = me.domHandler.getElementSelector(this);\n            if(parentSelector === null) {\n                return origAppend.apply(this, arguments);\n            }\n\n            const parentNode = me.domHandler.getNodeFromElement(this);\n            if(!parentNode) {\n                return console.error('parent node not found', parentSelector, this);\n            }\n            let node: VdomNode;\n            let keepChildren = false;\n\n            if(el['parentSelector']) {\n                node = me.domHandler.getVisNode(el);\n\n                me.getNewRemoveChild(() => {}).call(this, el);\n                keepChildren = true; // If the element is being moved around, keep children.\n            } else {\n                node = me.domHandler.getNodeDataFromEl(el);\n            }\n\n            el.parentSelector = parentSelector;\n            el.selector = me.domHandler.getElementSelector(el, parentNode);\n            el.childIndex = parentNode.children.length;\n\n            Object.defineProperty(el, 'style', {\n                writable: true,\n                value: {\n                    setProperty: function(styleProp: string, value: string) {\n                        me.domHandler.queueSetAttributeOnElement(el, 'style;' + styleProp, value);\n                    },\n                    getPropertyValue: function(styleProp) {\n                        me.domHandler.enableFrontendDesignProperties();\n                        return node.style[styleProp];\n                    },\n                    removeProperty: function() {\n                        console.log('remove property not yet implemented.');\n                        //TODO implement removeProperty CSS function.\n                    }\n                }\n            });\n\n            Object.defineProperty(el, 'parentNode', {\n                writable: true,\n                value: this\n            });\n    \n            me.domHandler.linkNodeToElement(node, el);\n            me.vdom.addNodeToParent(node, parentNode.globalElementIndex);\n            me.domHandler.restyleNode(parentNode, node);\n            me.updateChildSelectors(el, node);\n\n            if(me.useWorker) {\n                me.enterExitQueue.push({\n                    cmd: 'ENTER',\n                    node: node,\n                    parentGlobalIndex: parentNode.globalElementIndex,\n                    keepChildren: keepChildren\n                });\n            } else {\n                if(me.renderer.addNode) {\n                    me.renderer.addNode(node);\n                }\n            }\n    \n            if(me.unassignedNodes.indexOf(el) !== -1) {\n                const index = me.unassignedNodes.indexOf(el);\n                me.unassignedNodes.splice(index, 1);\n            }\n    \n            return el;\n        };\n    }\n    \n    private replaceNativeAppendChild() {\n        const origAppendChild = Element.prototype.appendChild;\n        const newAppend = this.getNewAppendChild(origAppendChild);\n    \n        Element.prototype.appendChild = newAppend;\n        Element.prototype.insertBefore = function<T extends Node>(newChild: T, refChild: Node|null) {\n    \n            newAppend.call(this, newChild);\n            \n            return newChild;\n        };\n    }\n\n    private replaceNativePathFunctions() {\n        const me = this;\n        //const origGetPointAtLength = SVGPathElement.prototype.getPointAtLength;\n        const origGetTotalLength = SVGPathElement.prototype.getTotalLength;\n\n        /*SVGPathElement.prototype.getPointAtLength = function() {\n            if(me.isWithinSvg(this)) {\n                const d = this.getAttribute('d');\n                me.origSetAttribute.call(this, 'd', d);\n            }\n            return origGetPointAtLength.apply(this, arguments);\n        };*/\n        SVGPathElement.prototype.getTotalLength = function() {\n            if(me.isWithinSvg(this)) {\n                const d = this.getAttribute('d');\n                me.origSetAttribute.call(this, 'd', d);\n            }\n\n            return origGetTotalLength.apply(this, arguments);\n        };\n    }\n\n    private origSetAttribute;\n\n    private replaceNativeAttribute() {\n        const origSetAttr = Element.prototype.setAttribute;\n        this.origSetAttribute = origSetAttr;\n        const origSetAttrNS = Element.prototype.setAttributeNS;\n        const origGetAttr = Element.prototype.getAttribute;\n        const me = this;\n    \n        Element.prototype.setAttribute = function(this: SsvgElement, name: string, value: any) {\n            if(name === 'easypz' || me.unassignedNodes.indexOf(this) !== -1) {\n                // Update the original SVG\n                origSetAttr.apply(this, arguments);\n                return;\n            }\n            if(name === 'class') {\n                origSetAttr.apply(this, arguments);\n            }\n            if(!me.isWithinSvg(this)) {\n                return origSetAttr.apply(this, arguments);\n            }\n            me.domHandler.queueSetAttributeOnElement(this, name, value);\n        };\n        //TODO: Figure out how to access the element when setting a style property.\n        /*CSSStyleDeclaration.prototype.setProperty = function(name: string, value: any) {\n            safeLog(this, arguments);\n            me.elementHandler.queueSetAttributeOnElement(this, 'style;' + name, value);\n        };*/\n        Element.prototype.setAttributeNS = function(this: SsvgElement, name: string, value: any) {\n            if(name === 'easypz' || me.unassignedNodes.indexOf(this) !== -1) {\n                // Update the original SVG\n                origSetAttrNS.apply(this, arguments);\n                return;\n            }\n            if(name === 'class') {\n                origSetAttrNS.apply(this, arguments);\n            }\n            if(!me.isWithinSvg(this)) {\n                return origSetAttrNS.apply(this, arguments);\n            }\n            me.domHandler.queueSetAttributeOnElement(this, name, value);\n        };\n    \n        Element.prototype.getAttribute = function(this: SsvgElement, name) {\n            if(me.unassignedNodes.indexOf(this) !== -1) {\n                return origGetAttr.apply(this, arguments);\n            } else {\n                try {\n                    return me.domHandler.getAttributeFromSelector(this, name);\n                } catch(e) {\n                    console.error(e);\n                    return origGetAttr.apply(this, arguments);\n                }\n            }\n        };\n    }\n    \n    private propagateMouseEvent(evt: MouseEvent, type?: string) {\n        return this.propagateEvent(new MouseEvent(type? type : evt.type, evt));\n    }\n\n    private duplicateTouchEvent(evt: TouchEvent, type?: string) {\n        const e = document.createEvent('TouchEvent');\n        if(!type) {\n            type = evt.type;\n        }\n        e.initEvent(type, true, false);\n        for(const prop in evt) {\n            if(prop !== 'isTrusted' && evt.hasOwnProperty(prop)) {\n                Object.defineProperty(e, prop, {\n                    writable: true,\n                    value: evt[prop],\n                });\n            }\n        }\n        Object.defineProperty(e, 'type', {\n            writable: true,\n            value: type,\n        });\n        const touches = [];\n        for(let i = 0; i < evt.touches.length; i++) {\n            const touch = evt.touches[i];\n            touches.push({identifier: touch.identifier, pageX: touch.pageX, pageY: touch.pageY,\n                clientX: touch.clientX, clientY: touch.clientY});\n        }\n        Object.defineProperty(e, 'touches', {\n            writable: true,\n            value: touches,\n        });\n        return e;\n    }\n\n    private propagateTouchEvent(evt: TouchEvent, type?: string) {\n        return this.propagateEvent(this.duplicateTouchEvent(evt, type));\n    }\n    \n    private propagateWheelEvent(evt: WheelEvent) {\n        return this.propagateEvent(new WheelEvent(evt.type, evt));\n    }\n    \n    private propagateEvent(new_event: MouseEvent|TouchEvent|WheelEvent): undefined|Element {\n        this.svg.dispatchEvent(new_event); // for EasyPZ\n\n        let triggeredElement: undefined|Element;\n        const {x, y} = SSVG.getMousePosition(new_event);\n\n        for(let interactionSel of this.interactionSelections)\n        {\n            let parentSelector = this.domHandler.getElementSelector(interactionSel);\n            let parentNode = this.vdom.getVisNodeFromSelector(parentSelector);\n            \n            //let matchingVisParent = selectedNodes[i];\n            let j = 1;\n            \n            if(!parentNode) {\n                //console.error(interactionSel, parentSelector, parentNode);\n            } else {\n                for(let vdomNode of parentNode.children)\n                {\n\n                    let childNode = this.nodeAtPosition(vdomNode, x - 10, y - 10);\n                    if(childNode)\n                    {\n                        const svgEl = this.domHandler.getElementFromNode(vdomNode);\n                        const svgChildEl = this.domHandler.getElementFromNode(childNode);\n\n                        if(svgChildEl) {\n                            Object.defineProperty(new_event, 'target', {\n                                writable: true,\n                                value: svgChildEl\n                            });\n                        }\n\n                        if(svgChildEl) {\n                            triggeredElement = svgChildEl;\n                            svgChildEl.dispatchEvent(new_event);\n                        }\n\n                        if(svgEl) {\n                            if(!triggeredElement) {\n                                triggeredElement = svgEl;\n                            }\n                            svgEl.dispatchEvent(new_event);\n                        }\n                    }\n                    j++;\n                }\n            }\n        }\n        return triggeredElement;\n    }\n\n    //TODO move this function somewhere else.\n    private static getMousePosition(event: MouseEvent|TouchEvent) : {x: number, y: number}|null\n    {\n        let pos = {x: 0, y: 0};\n\n        if((event.type.substr(0,5) === 'mouse' || event.type === 'click') && event['clientX'])\n        {\n            pos = {x: event['clientX'], y: event['clientY']};\n        }\n        else if(event.type.substr(0,5) === 'touch')\n        {\n            const touches = event['touches'] ? event['touches'] : [];\n            if(touches.length < 1) return null;\n            pos = {x: touches[0].clientX, y: touches[0].clientY};\n        }\n\n        return pos;\n    }\n    \n    private nodeAtPosition(visNode: VdomNode, x: number, y: number): false|VdomNode {\n        if (visNode.type === 'circle') {\n            let cx = this.vdom.get(visNode, 'cx') || 0;\n            let cy = this.vdom.get(visNode, 'cy') || 0;\n            if (visNode.transform) {\n                const transform = DrawingUtils.parseTransform(visNode.transform);\n                if (transform.translateX) {\n                    cx += transform.translateX;\n                }\n                if (transform.translateY) {\n                    cy += transform.translateY;\n                }\n            }\n            const distance = Math.sqrt(Math.pow(cx - x, 2) + Math.pow(cy - y, 2));\n            return distance < visNode.r ? visNode : false;\n        } else if(visNode.type === 'rect' || visNode.type === 'image') {\n\n            let elX = this.vdom.get(visNode, 'x') || 0;\n            let elY = this.vdom.get(visNode, 'y') || 0;\n            const width = visNode.width;\n            const height = visNode.height;\n\n            if (visNode.transform) {\n                const transform = DrawingUtils.parseTransform(visNode.transform);\n                if (transform.translateX) {\n                    elX += transform.translateX;\n                }\n                if (transform.translateY) {\n                    elY += transform.translateY;\n                }\n            }\n\n            const centerX = elX + width / 2;\n            const centerY = elY + height / 2;\n\n            const distanceX = Math.abs(centerX - x);\n            const distanceY = Math.abs(centerY - y);\n\n            return distanceX < width / 2 && distanceY < height / 2 ? visNode : false;\n\n        } else if(visNode.type === 'g') {\n\n            const transform = this.domHandler.getTotalTransformation(visNode);\n            if(transform.translateX) {\n                x -= transform.translateX;\n            }\n            if(transform.translateY) {\n                y -= transform.translateY;\n            }\n\n            let matchAny: false|VdomNode = false;\n            for(let i = 0; i < visNode.children.length; i++) {\n                if(this.nodeAtPosition(visNode.children[i], x, y)) {\n                    matchAny = visNode.children[i];\n                }\n            }\n            return matchAny;\n        }\n        return false;\n    }\n    \n    private logDrawn() {\n        this.lastCanvasDrawTimes.push(Date.now());\n        \n        if(this.lastCanvasDrawTimes.length > 100) {\n            this.lastCanvasDrawTimes.shift(); // Remove first item\n        }\n    }\n    \n    private updateFps() {\n        if(this.lastCanvasDrawTimes.length) {\n            const timeForTenDrawsMs = Date.now() - this.lastCanvasDrawTimes[0];\n            const fps = Math.round(this.lastCanvasDrawTimes.length / timeForTenDrawsMs * 1000);\n            this.getFps(fps);\n        }\n    }\n\n    private sendUpdateToWorker(queue) {\n        const msg: CanvasUpdateWorkerMessage = {\n            cmd: 'UPDATE_NODES',\n            data: {\n                enterExit: this.enterExitQueue,\n                update: queue,\n            }\n        };\n\n        this.sendToWorker(msg);\n\n        this.enterExitQueue = [];\n    }\n\n    private sendToWorker(msg: CanvasWorkerMessage, data?: any) {\n        this.worker.postMessage(msg, data);\n        //console.log(roughSizeOfObject(msg));\n    }\n}\n\n\nlet safeLogCount = 0;\nfunction safeLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.log(...logContents);\n    }\n}\nfunction safeErrorLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.error(...logContents);\n    }\n}\n","import {VDOM, VdomNode, VdomNodeType} from \"../util/vdom/vdom\";\nimport {VdomManager} from \"../util/vdom/vdom-manager\";\nimport DrawingUtils, {Transformation} from \"../canvasworker/drawingUtils\";\nimport drawingUtils from \"../canvasworker/drawingUtils\";\n\nexport const CSS_STYLES = ['stroke', 'stroke-opacity', 'stroke-width', 'stroke-linejoin',\n    'fill', 'fill-opacity', 'font', 'opacity', 'font-family', 'font-size'];\n\nexport default class Domhandler {\n    private readonly vdom: VdomManager;\n    public nodesToElements: { nodes: VdomNode[], elements: SsvgElement[]} = { nodes: [], elements: []};\n    private nodesToRestyle: VdomNode[] = [];\n    private globalElementIndexCounter = 0;\n\n    constructor(private svg: SVGElement & SsvgElement, useWorker: boolean, private ignoreDesign: boolean) {\n        const visData: VDOM = {\n            type: 'svg',\n            width: parseInt(this.svg.getAttribute('width')),\n            height: parseInt(this.svg.getAttribute('height')),\n            scale: 1,\n            children: [],\n            globalElementIndex: 0,\n            style: {},\n            styleSpecificity: {},\n        };\n\n        this.vdom = new VdomManager(visData, ignoreDesign);\n        this.linkNodeToElement(visData, this.svg);\n        this.svg.style.display = 'none';\n        this.svg['selector'] = 'svg';\n\n        this.addChildNodesToVisData(this.svg.childNodes, this.vdom.data);\n\n        window.setTimeout(() => {\n            // Re-do the styles.\n            this.nodesToRestyle = [];\n            // Can not use this.nodesToRestyle = this.nodesToElements.nodes because this links the object and adding\n            // to this.nodesToRestyle would break the nodesToElements mapping.\n            for(const node of this.nodesToElements.nodes) {\n                this.nodesToRestyle.push(node);\n            }\n        }, 100);\n    }\n\n    enableFrontendDesignProperties() {\n        this.ignoreDesign = false;\n        this.vdom.enableFrontendDesignProperties();\n    }\n    \n    getVDom() {\n        return this.vdom;\n    }\n    \n    queueSetAttributeOnElement(element: SsvgElement, attrName: string,\n                               value: (number|string|((el: HTMLElement) => (number|string)))) {\n        //TODO: merge with updatePropertiesFromQueue from VdomManager?\n        const parent = element.parentNode;\n        let parentSelector = parent === this.svg ? \"svg\" : element.parentSelector;\n        let childIndex = element.childIndex;\n    \n        if(!parentSelector && element === this.svg) {\n            parentSelector = 'SVG_PARENT';\n            childIndex = 0;\n        }\n    \n        if(!parentSelector) {\n            safeLog(element, parent);\n            console.error('selector not found');\n            return;\n        }\n\n        if(element === this.svg && attrName.indexOf('style;') === 0) {\n            attrName = attrName.substr('style;'.length);\n        }\n        //attrName = this.checkAttrName(parentSelector, attrName, false);\n        this.vdom.ensureInitialized(attrName, false, this.globalElementIndexCounter);\n\n        const evaluatedValue = typeof value === \"function\" ? value.call(element, element.__data__, childIndex) : value;\n        //const node = this.getNodeFromElement(element);\n        //this.setAttrQueue.set(node, attrName, evaluatedValue, false);\n        const node = this.getNodeFromElement(element);\n        this.vdom.set(node, attrName, evaluatedValue, false);\n        if(attrName.indexOf('style;') === 0) {\n            const longSpecName = 'styleSpecificity;' + attrName.substr(6);\n            this.vdom.ensureInitialized(longSpecName, false, this.globalElementIndexCounter);\n            this.vdom.set(node, longSpecName, 3000, false);\n        }\n\n\n        if(attrName === \"href\") {\n            try {\n                fetch(location.origin + evaluatedValue, {mode: 'cors'})\n                    .then(resp => resp.blob())\n                    .then(blob => createImageBitmap(blob))\n                    .then(bitmap => {\n                        //this.checkAttrName(parentSelector, \"image\", false);\n                        this.vdom.ensureInitialized(\"image\", false, this.globalElementIndexCounter);\n                        this.vdom.set(node, 'image', bitmap, false);\n                    });\n            }\n            catch(e) {console.log(e);}\n        }\n\n        if(attrName === 'class' || attrName.indexOf('style') !== -1) {\n            // Apply classes immediately so styles can be applied correctly.\n\n            if(attrName === 'class') {\n                node.className = evaluatedValue;\n                this.nodesToRestyle.push(node);\n            } else {\n                const styleName = attrName.substr(6);\n                if(!node.style) {\n                    console.error('no styles on node ', node);\n                }\n                node.style[styleName] = evaluatedValue;\n            }\n        }\n    }\n\n    logged = 0;\n    queueSetAttributeOnSelection(elements: SsvgElement[], attrName: string, value) {\n        if(!elements.length) return;\n        if(!elements[0]) {\n            //console.error('selection elements not found', elements);\n            return;\n        }\n        const useSharedArray = 'SharedArrayBuffer' in self;\n\n        let parentElement = elements[0].parentNode;\n        let parentSelector = parentElement === this.svg ? \"svg\" : parentElement['selector'];\n        if(!parentSelector) {\n            safeLog(elements, parentElement);\n            console.error('selector not found');\n        }\n\n        this.vdom.ensureInitialized(attrName, useSharedArray, this.globalElementIndexCounter);\n        let longSpecName;\n        if(attrName.indexOf('style;') === 0) {\n            longSpecName = 'styleSpecificity;' + attrName.substr(6);\n            this.vdom.ensureInitialized(longSpecName, useSharedArray, this.globalElementIndexCounter);\n        }\n\n        for(let i = 0; i < elements.length; i++) {\n            const svgEl = elements[i];\n\n            const evaluatedValue = typeof value === \"function\" ? value(svgEl.__data__, i) : value;\n            this.ensureElementIndex(svgEl);\n\n            this.vdom.set(svgEl, attrName, evaluatedValue, useSharedArray);\n\n            if(longSpecName) {\n                this.vdom.set(svgEl, longSpecName, 3000, false);\n            }\n\n            //TODO: re-implement.\n            /*if(attrName === \"href\") {\n                try {\n                    fetch(location.origin + evaluatedValue, {mode: 'cors'})\n                    .then(resp => resp.blob())\n                    .then(blob => createImageBitmap(blob))\n                    .then(bitmap => {\n                        //this.checkAttrName(parentSelector, \"image\", useSharedArray, parentNode);\n                        this.setAttrQueue.ensureInitialized(\"image\", false);\n                        this.setAttrQueue[parentSelector][\"image\"][indexOfParent] = bitmap;\n                    });\n                }\n                catch(e) {console.log(e);}\n            }*/\n        }\n\n        if(attrName === 'className' || attrName.indexOf('style') !== -1) {\n            // Apply classes immediately so styles can be applied correctly.\n            for(let i = 0; i < elements.length; i++) {\n                const node = this.getNodeFromElement(elements[i]);\n                const evaluatedValue = typeof value === \"function\" ? value(elements[i].__data__, i) : value;\n\n                if(attrName === 'className') {\n                    node.className = evaluatedValue;\n                    this.nodesToRestyle.push(node);\n                } else {\n                    const styleName = attrName.substr(6);\n                    node.style[styleName] = evaluatedValue;\n                }\n            }\n        }\n    }\n\n    ensureElementIndex(svgEl: SsvgElement) {\n        if(!svgEl.globalElementIndex) {\n            const node = this.getNodeFromElement(svgEl);\n            svgEl.globalElementIndex = node.globalElementIndex;\n        }\n    }\n\n    useAttrQueue(cb: (data) => void = () => {}) {\n        if(this.nodesToRestyle) {\n            this.applyStyles();\n        }\n\n        const data = this.vdom.getQueue();\n        cb(data);\n        this.vdom.updatePropertiesFromQueue(data);\n        this.vdom.clearQueue();\n    }\n\n    getAttributeFromSelector(element: SsvgElement, name: string) {\n        const node = this.getNodeFromElement(element);\n        \n        if(!node) {\n            console.error('trying to get attribute for unfit selection', node, element, name);\n            throw Error('element not found');\n        }\n        \n        return node[name];\n    }\n    \n    getVisNode(element: SsvgElement): VdomNode|null {\n        if(element === this.svg) {\n            return this.vdom.data;\n        }\n        return this.vdom.getNodeFromIndex(element.globalElementIndex);\n        /*const selector = this.getElementSelector(element);\n\n        if(selector === null) {\n            return null;\n        }\n        \n        return this.vdom.getVisNodeFromSelector(selector);*/\n    }\n    \n    getNodeDataFromEl(el: HTMLElement): VdomNode {\n        const roundedAttrs = ['cx', 'cy', 'r', 'x', 'y', 'x1', 'x2', 'y1', 'y2', 'width', 'height', 'stroke-width'];\n\n        const node = {\n            type: el.tagName.toLowerCase() as VdomNodeType,\n            className: el.getAttribute('class'),\n            style: {},\n            styleSpecificity: {},\n            children: [],\n            globalElementIndex: -1,\n            text: !el.childNodes || (el.childNodes.length === 1 && !(el.childNodes[0] as HTMLElement).tagName)\n                ? el.textContent : undefined,\n        };\n\n        for(let i = 0; i < el.attributes.length; i++) {\n            let value: string|number = el.attributes[i].nodeValue;\n            if(roundedAttrs.indexOf(el.attributes[i].nodeName) !== -1) {\n                value = parseFloat(value);\n            }\n            node[el.attributes[i].nodeName] = value;\n        }\n        node.style = {};\n\n        for(const styleProp in el.style) {\n            if(el.style.hasOwnProperty(styleProp)) {\n                const val = el.style[styleProp];\n                if(val !== '' && typeof el.style[styleProp] !== 'function') {\n                    const kebabCase = styleProp.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n                    node.style[kebabCase] = el.style[styleProp];\n                    node.styleSpecificity[kebabCase] = 5000;\n                }\n            }\n        }\n\n        const clean = obj => {\n            const propNames = Object.getOwnPropertyNames(obj);\n            for (let i = 0; i < propNames.length; i++) {\n                const propName = propNames[i];\n                if (obj[propName] === null || obj[propName] === undefined) {\n                    delete obj[propName];\n                }\n            }\n        };\n        \n        clean(node);\n        \n        return node;\n    }\n\n    private applyStyles() {\n        for (let i = 0; i < document.styleSheets.length; i++) {\n            const sheet = document.styleSheets[i] as any;\n            const rules = (sheet.rules ? sheet.rules : sheet.cssRules) as CSSRuleList;\n        \n            for (let j = 0; j < rules.length; j++) {\n                const rule = rules[j] as any;\n                const selector = rule.selectorText as string;\n                if(!selector) {\n                    continue; // Skip @imports etc.\n                }\n                this.applyRuleToMatchingNodes(selector, rule);\n            }\n        }\n\n        this.nodesToRestyle = [];\n    }\n\n    updateNodeSelector(oldSelector: string, newSelector: string) {\n        /*if(oldSelector === newSelector) {\n            return;\n        }\n        if(this.setAttrQueue[newSelector]) {\n            console.warn('having problems rearranging the elements! old:', oldSelector, ', new:', newSelector,\n                this.setAttrQueue[oldSelector], this.setAttrQueue[newSelector]);\n            delete this.setAttrQueue[oldSelector];\n        } else {\n            this.setAttrQueue[newSelector] = this.setAttrQueue[oldSelector];\n            delete this.setAttrQueue[oldSelector];\n        }*/\n    }\n\n    private applyRuleToMatchingNodes(selectorString: string, rule: {style: {[settingName: string]: string}}): boolean {\n        selectorString = selectorString.trim();\n\n        const selector = selectorString\n            .replace(' >', '>')\n            .replace('> ', '>')\n            .replace('svg>', '');\n        \n        const selectorPartsLooseStrict = selector.split(' ')\n            .map(part => part.split('>'));\n\n        const parentsOfInterest = [];\n        for(const nodeToBeStyled of this.nodesToRestyle) {\n            let parent = this.getNodeParent(nodeToBeStyled);\n            while(parent && parentsOfInterest.indexOf(parent) === -1) {\n                parentsOfInterest.push(parent);\n                parent = this.getNodeParent(parent);\n            }\n        }\n        const specificity = DrawingUtils.getCssRuleSpecificityNumber(selectorString);\n\n        const setStyle = (styleName: string, rule: {style: {[settingName: string]: string}}, child: VdomNode) => {\n            if(rule.style[styleName]) {\n                const longName = 'style;' + styleName;\n                const longSpecName = 'styleSpecificity;' + styleName;\n                this.vdom.ensureInitialized(longName, false, this.globalElementIndexCounter);\n                this.vdom.ensureInitialized(longSpecName, false, this.globalElementIndexCounter);\n                /*this.checkAttrName(parentSelector, longName);\n                this.checkAttrName(parentSelector, longSpecName);*/\n                let setValue = false;\n\n                if(!this.vdom.getQueueValue(child, longName) && !child.style[styleName]) {\n                    setValue = true;\n                } else {\n                    if(child.styleSpecificity[styleName]) {\n                        // If a later rule has the same or higher specificity, apply.\n                        // Hence, later rules override earlier rules.\n                        if(child.styleSpecificity[styleName] <= specificity) {\n                            if(this.vdom.getQueueValue(child, longSpecName)) {\n                                setValue = this.vdom.getQueueValue(child, longSpecName) <= specificity;\n                            } else {\n                                setValue = true;\n                            }\n                        } else {\n                            setValue = this.vdom.getQueueValue(child, longSpecName) <= specificity;\n                        }\n                    } else {\n                        setValue = this.vdom.getQueueValue(child, longSpecName) <= specificity;\n                    }\n                }\n\n                if(setValue) {\n                    this.vdom.set(child, longName, rule.style[styleName], false);\n                    this.vdom.set(child, longSpecName, specificity, false);\n                    /*this.setAttrQueue[parentSelector][longName][childIndex] = rule.style[styleName];\n                    this.setAttrQueue[parentSelector][longSpecName][childIndex] = specificity;*/\n                }\n            }\n        };\n\n        const checkNode = (currentNode: VdomNode, looseIndex = 0, strictIndex = 0): boolean => {\n            const selPart = selectorPartsLooseStrict[looseIndex][strictIndex];\n\n            for(let childIndex = 0; childIndex < currentNode.children.length; childIndex++) {\n                const child = currentNode.children[childIndex];\n                if(parentsOfInterest.indexOf(child) === -1 && this.nodesToRestyle.indexOf(child) === -1) {\n                    continue;\n                }\n                let partialMatch = VdomManager.isCssRulePartialMatch(selPart, child, currentNode);\n\n                if(partialMatch) {\n                    if(selectorPartsLooseStrict[looseIndex].length > strictIndex + 1) {\n                        checkNode(child, looseIndex, strictIndex + 1);\n                    } else if(selectorPartsLooseStrict.length > looseIndex + 1) {\n                        checkNode(child, looseIndex + 1, strictIndex);\n                    } else {\n                        for(const styleName of CSS_STYLES) {\n                            setStyle(styleName, rule, child);\n                        }\n                    }\n                } else {\n                    if(child['removedClasses']) {\n                        // temporarily add the class, see if it matches this rule, and if so, un-apply its stuff.\n                        for(const removedClass of child['removedClasses']) {\n                            child.className += ' ' + removedClass;\n\n                            let newPartialMatch = VdomManager.isCssRulePartialMatch(selPart, child, currentNode);\n                            if(newPartialMatch) {\n                                const parentSelector = this.getNodeSelector(currentNode);\n                                this.removeRuleStylesFromNode(parentSelector, child, childIndex, rule, specificity);\n                            }\n\n                            child.className = child.className.substr(0, child.className.length -\n                                removedClass.length - 1);\n                        }\n                        setTimeout(() => {\n                            delete child['removedClasses'];\n                        }); // After this frame, reset which classes have been removed.\n                    }\n                    checkNode(child, looseIndex, strictIndex);\n                }\n            }\n            return false;\n        };\n\n        return checkNode(this.vdom.data);\n    }\n\n    removeRuleStylesFromNode(parentSelector: string, child: VdomNode, childIndex: number,\n                             rule: {style: {[settingName: string]: string}}, specificity: number) {\n        if(rule.style['stroke']) {\n            const color = drawingUtils.colorToRgba(rule.style['stroke']);\n            if(child.style['stroke'] === color || child.style['stroke-rgba'] === color) {\n                //this.checkAttrName(parentSelector, 'style;stroke');\n                //this.setAttrQueue[parentSelector]['style;stroke'][childIndex] = '';\n                //this.checkAttrName(parentSelector, 'style;stroke-rgba');\n                //this.setAttrQueue[parentSelector]['style;stroke-rgba'][childIndex] = '';\n\n                this.vdom.ensureInitialized('style;stroke', false, this.globalElementIndexCounter);\n                this.vdom.ensureInitialized('styleSpecificity;stroke', false, this.globalElementIndexCounter);\n                this.vdom.ensureInitialized('style;stroke-rgba', false, this.globalElementIndexCounter);\n                this.vdom.ensureInitialized('styleSpecificity;stroke-rgba', false, this.globalElementIndexCounter);\n                this.vdom.set(child, 'style;stroke', '', false);\n                this.vdom.set(child, 'styleSpecificity;stroke', specificity, false);\n                this.vdom.set(child, 'style;stroke-rgba', '', false);\n                this.vdom.set(child, 'styleSpecificity;stroke-rgba', specificity, false);\n            }\n        }\n        //TODO remove other styles.\n    }\n\n    removeNodeFromParent(element: Element, node: VdomNode, parentNode: VdomNode) {\n        const childIndex = element['childIndex'];\n        //console.log('removing', node, 'from', parentNode, [...parentNode.children], childIndex, childIndex2);\n        this.vdom.removeNode(childIndex, parentNode.globalElementIndex);\n        let index = this.nodesToElements.nodes.indexOf(node);\n        if(index === -1) {\n            return console.error('node not found', node);\n        }\n\n        this.nodesToElements.nodes.splice(index, 1);\n        this.nodesToElements.elements.splice(index, 1);\n\n        // Remove all pending changes on this element\n        //this.setAttrQueue.removePendingChanges(node);\n    }\n\n    restyleNode(parentNode, node) {\n        this.nodesToRestyle.push(node);\n    }\n    \n    private addChildNodesToVisData(childEls: HTMLElement[]|NodeList, parentNode: VdomNode): void {\n        const parentEl = this.getElementFromNode(parentNode);\n\n        for(let i  = 0; i < childEls.length; i++) {\n            let el = childEls[i] as SsvgElement;\n            \n            try\n            {\n                const node = this.getNodeDataFromEl(el);\n\n                el.parentSelector = this.getElementSelector(parentEl);\n                el.selector = this.getElementSelector(el);\n                el.childIndex = parentNode.children.length;\n\n                parentNode.children.push(node);\n                this.linkNodeToElement(node, el);\n                this.nodesToRestyle.push(node);\n                \n                if(el.childNodes)\n                {\n                    this.addChildNodesToVisData(el.childNodes, node);\n                }\n                if(node.type === 'tspan')\n                {\n                    //console.log(node, el, el.childNodes, el.textContent);\n                    //console.log(el.childNodes[0])\n                    //console.log(node, style.textAnchor);\n                }\n                if(node.type === 'text')\n                {\n                    //console.log(node, el, el.childNodes, el.textContent);\n                }\n            }\n            catch(e)\n            {\n                //console.log(e);\n                //console.log(el);\n            }\n        }\n    }\n\n    getNodeSelector(node: VdomNode): string {\n        if(node === this.vdom.data) {\n            return 'svg';\n        }\n        const element = this.getElementFromNode(node);\n        if(!element) {\n            console.error('could not find element for node ', node);\n            return '';\n        }\n        return this.getElementSelector(element, undefined, node);\n    }\n    \n    getElementSelector(element: SsvgElement, parentNode?: VdomNode, node?: VdomNode): string|null {\n        let sel = element['selector'];\n        \n        if(sel)\n        {\n            return sel;\n        }\n        else\n        {\n            if(element === this.svg) {\n                sel = 'svg';\n            } else {\n                let parentSelector = element.parentSelector ? element.parentSelector : '';\n\n                if(!parentNode) {\n                    parentNode = this.vdom.getVisNodeFromSelector(parentSelector);\n                }\n                if(!parentNode) {\n                    console.warn('Element not found', element, parentSelector, parentSelector.length, this.vdom.data);\n                    return null;\n                }\n                let index = parentNode.children.length + 1;\n                if(node && parentNode.children.indexOf(node) !== -1) {\n                    index = parentNode.children.indexOf(node) + 1;\n                }\n                let name = element.localName;\n                if (!name) {\n                    console.error(parentNode);\n                    throw Error('name is null');\n                }\n                name = name.toLowerCase();\n                sel = this.combineElementSelectors(parentSelector, name, index);\n            }\n            \n            return sel;\n        }\n    }\n\n    combineElementSelectors(parentSelector: string, elementType: string, childIndex: number) {\n        return parentSelector + ' > ' + elementType + ':nth-child(' + childIndex + ')';\n    }\n\n    getNodeParent(node:VdomNode): VdomNode|null {\n        if(node === this.vdom.data) {\n            return null;\n        }\n        const el = this.getElementFromNode(node);\n        if(!el) {\n            return null;\n        }\n        const parentEl = el.parentNode as SsvgElement;\n        return this.getNodeFromElement(parentEl);\n    }\n\n    linkNodeToElement(node: VdomNode, element: SsvgElement) {\n        this.nodesToElements.nodes.push(node);\n        this.nodesToElements.elements.push(element);\n\n        node.globalElementIndex = this.globalElementIndexCounter;\n        element.globalElementIndex = this.globalElementIndexCounter;\n        this.globalElementIndexCounter++;\n\n        this.vdom.addNode(node);\n    }\n\n    getElementFromNode(node: VdomNode): SsvgElement {\n        if(node === this.vdom.data) {\n            return this.svg;\n        }\n        const nodeIndex = this.nodesToElements.nodes.indexOf(node);\n        return this.nodesToElements.elements[nodeIndex];\n    }\n\n    getNodeFromElement(element: SsvgElement): VdomNode {\n        if(element === this.svg) {\n            return this.vdom.data;\n        }\n        return this.vdom.getNodeFromIndex(element.globalElementIndex);\n    }\n\n    getParentNode(node: VdomNode): VdomNode|null {\n        const element = this.getElementFromNode(node);\n        const parentElement = element.parentNode as SsvgElement;\n        return this.getNodeFromElement(parentElement);\n    }\n\n    getTotalTransformation(node: VdomNode): Transformation {\n        let parent = this.getParentNode(node);\n        const parents = [node];\n\n        while(parent) {\n            parents.push(parent);\n            parent = this.getParentNode(parent);\n        }\n\n        parent = parents.pop();\n        let totalTransform: Transformation = {\n            translateX: 0,\n            translateY: 0,\n            scaleX: 0,\n            scaleY: 0,\n            rotate: 0,\n            translateBeforeScale: false\n        };\n\n        while(parent) {\n            const transform = DrawingUtils.parseTransform(parent.transform);\n            totalTransform = DrawingUtils.addTransforms(totalTransform, transform);\n            parent = parents.pop();\n        }\n\n        return totalTransform;\n    }\n}\n\nlet safeLogCount = 0;\nfunction safeLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.log(...logContents);\n    }\n}\nfunction safeErrorLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.error(...logContents);\n    }\n}\n\nexport type SsvgElement = HTMLElement & {\n    __data__: any,\n    globalElementIndex: number,\n    parentSelector: string,\n    selector: string,\n    childIndex: number\n};\n","import DrawingUtils from \"../../canvasworker/drawingUtils\";\nimport SetPropertyQueueData from \"./set-property-queue-data\";\nimport {VDOM, VdomNode} from \"./vdom\";\nimport {SsvgElement} from \"../../frontend/domhandler\";\n\nexport class VdomManager {\n    private sharedData: {[attrName: string]: Int32Array} = {};\n    private queue: SetPropertyQueueData = {};\n    private useSharedArrayFor = ['cx', 'cy', 'x1', 'x2', 'y1', 'y2', 'x', 'y'];\n    private static IGNOREDESIGN_ATTRIBUTES = ['fill', 'stroke', 'opacity'];\n    private indexToNodeMap: {[index: number]: VdomNode} = {};\n    private static BUFFER_PRECISION_FACTOR = 10;\n    \n    constructor(public data: VDOM, private ignoreDesign: boolean) {\n        this.ensureNodesMapped();\n    }\n\n    ensureInitialized(attrName: string, useBuffer: boolean, numNodes?: number) {\n        if(attrName === 'class') {\n            attrName = 'className';\n        }\n\n        if(!useBuffer || this.useSharedArrayFor.indexOf(attrName) === -1) {\n            if(!this.queue[attrName]) {\n                this.queue[attrName] = [];\n            }\n        } else {\n            if(!this.sharedData[attrName]) {\n                const length = numNodes < 500 ? 1000 : numNodes * 2;\n                const buffer = new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT * length);\n                const values = new Int32Array(buffer);\n\n                // If values have been previously set without a buffer, transfer them.\n                if(this.queue[attrName] &&\n                    !(this.queue[attrName] instanceof SharedArrayBuffer)) {\n                    const prevData: string[] = <any> this.queue[attrName];\n\n                    prevData.forEach((value, index) => {\n                        values[index] = parseFloat(value) * VdomManager.BUFFER_PRECISION_FACTOR;\n                    });\n                }\n\n                this.queue[attrName] = buffer;\n                this.sharedData[attrName] = values;\n            } else {\n                const newLength = numNodes < 500 ? 1000 : numNodes * 2;\n                const newByteLength = Int32Array.BYTES_PER_ELEMENT * newLength;\n                if(this.sharedData[attrName].byteLength / newByteLength < 0.8) {\n                    // Need to allocate more space\n                    //console.log('more space needed. prev:', this.sharedData[attrName].byteLength / Int32Array.BYTES_PER_ELEMENT, 'new', newLength);\n                    const buffer = new SharedArrayBuffer(newByteLength);\n                    const values = new Int32Array(buffer);\n                    const oldVals = new Int32Array(this.sharedData[attrName]);\n\n                    for(const i in oldVals) {\n                        values[i] = oldVals[i];\n                    }\n                    this.queue[attrName] = buffer;\n                    this.sharedData[attrName] = values;\n                }\n            }\n        }\n    }\n\n    set(element: VdomNode|SsvgElement, attrName: string, value: any, useBuffer: boolean) {\n        if(attrName === 'class') {\n            attrName = 'className';\n        }\n        if(element.globalElementIndex === undefined) {\n            console.error('No index', element);\n            throw new Error('Element has no index');\n        }\n        const index = element.globalElementIndex;\n        const storage = useBuffer && this.useSharedArrayFor.indexOf(attrName) !== -1 ? 'shared' : 'raw';\n        try {\n            if(storage === 'shared') {\n                value *= VdomManager.BUFFER_PRECISION_FACTOR;\n                if(value === 0) {\n                    value = 133713371337; // magical constant\n                }\n                this.sharedData[attrName][index] = value;\n            } else {\n                this.queue[attrName][index] = value;\n                if(this.sharedData[attrName] && this.sharedData[attrName][index]) {\n                    // un-set.\n                    this.sharedData[attrName][index] = 0;\n                }\n            }\n        }\n        catch(e) {\n            console.error(e);\n            console.log(this.queue, this.sharedData, storage, attrName, element, index);\n        }\n    }\n\n    ensureNodesMapped() {\n        const addToMap = (node: VdomNode) => {\n            if(node.globalElementIndex === undefined) {\n                console.error('no element index', node);\n            }\n            this.indexToNodeMap[node.globalElementIndex] = node;\n            for(const child of node.children) {\n                addToMap(child);\n            }\n        };\n        addToMap(this.data);\n    }\n\n    enableFrontendDesignProperties() {\n        this.ignoreDesign = false;\n    }\n\n    addNodeToParent(nodeData: VdomNode, parentNodeIndex: number) {\n        let parentNode = this.getNodeFromIndex(parentNodeIndex);\n        if(!parentNode) {\n            console.error('could not add node without parent', parentNodeIndex, nodeData, Object.keys(this.indexToNodeMap));\n            new Error('parent not found');\n            return;\n        }\n        this.applyParentStyles(parentNode, nodeData);\n\n        parentNode.children.push(nodeData);\n    }\n    \n    addNode(nodeData: VdomNode) {\n        this.indexToNodeMap[nodeData.globalElementIndex] = nodeData;\n    }\n\n    removeNode(childIndex: number, parentNodeIndex: number) {\n        const parentNode = this.getNodeFromIndex(parentNodeIndex);\n\n        parentNode.children.splice(childIndex, 1);\n        this.cachedListSelections = {}; //TODO only remove relevant cache.\n    }\n\n    applyParentStyles(parentNode: VdomNode, childNode: VdomNode) {\n        for(const style in parentNode.style) {\n            if(!childNode.style[style]) {\n                childNode.style[style] = parentNode.style[style];\n            }\n        }\n    }\n    \n    getParentNodeFromSelector(parentSelector: string) {\n        if(!parentSelector) {\n            console.error('no parent selector', parentSelector);\n        }\n        //if(setAttrQueue.hasOwnProperty(parentSelector)) {\n        let parentNode;\n        if(parentSelector === 'SVG_PARENT') {\n            parentNode = {children: [this.data]};\n        } else {\n            parentNode = this.getVisNodeFromSelector(parentSelector);\n        }\n        if(!parentNode) {\n            console.error('parent node not found with selector', parentSelector);\n        }\n        return parentNode;\n    }\n\n    applyStyleToNodeAndChildren(node: VdomNode, styleName: string, styleValue: string, specificity: number) {\n        if(!node['styleSpecificity'][styleName] || node['styleSpecificity'][styleName] <= specificity) {\n            node['style'][styleName] = styleValue;\n            node['styleSpecificity'][styleName] = specificity;\n        }\n\n        if(node.children) {\n            for(let child of node.children) {\n                this.applyStyleToNodeAndChildren(child, styleName, styleValue, specificity);\n            }\n        }\n    }\n\n    getNodeFromIndex(index: number): VdomNode {\n        return this.indexToNodeMap[index];\n    }\n\n    getNodeById(id: string): VdomNode {\n        const filtered = Object.values(this.indexToNodeMap).filter(node => node.id === id);\n        if(!filtered || filtered.length > 1) {\n            safeLog('multiple nodes with this id!', Object.values(this.indexToNodeMap)\n                .filter(node => node.id).map(node => node.id), id);\n            safeLog(filtered.length, filtered);\n        }\n        return !filtered || filtered.length !== 1 ? null : filtered[0];\n    }\n\n    private static ROUNDED_ATTRS = ['cx', 'cy'];\n\n    get(node: VdomNode, attrName: string) {\n        if(this.sharedData[attrName] && this.sharedData[attrName][node.globalElementIndex]) {\n            if(this.sharedData[attrName][node.globalElementIndex] === 133713371337) {\n                return 0;\n            }\n            return this.sharedData[attrName][node.globalElementIndex] / VdomManager.BUFFER_PRECISION_FACTOR;\n        } else {\n            return node[attrName];\n        }\n    }\n\n    getQueueValue(node: VdomNode, attrName: string) {\n        return this.queue[attrName][node.globalElementIndex];\n    }\n\n    getQueue() {\n        return this.queue;\n    }\n\n    clearQueue() {\n        this.queue = {};\n    }\n\n    updatePropertiesFromQueue(setAttrQueue: SetPropertyQueueData) {\n                \n        for(let attrName in setAttrQueue) {\n            if(!setAttrQueue.hasOwnProperty(attrName)) {\n                continue;\n            }\n            const attrNameStart = attrName.substr(0, 'style;'.length);\n            if(this.ignoreDesign && (attrNameStart === 'style;' ||\n                VdomManager.IGNOREDESIGN_ATTRIBUTES.indexOf(attrName) !== -1)) {\n                continue;\n            }\n\n            let values: string[]|Int32Array;\n\n            if('SharedArrayBuffer' in self &&\n                setAttrQueue[attrName] instanceof SharedArrayBuffer) {\n                this.sharedData[attrName] = new Int32Array(<ArrayBuffer> setAttrQueue[attrName]);\n            } else {\n                values = setAttrQueue[attrName] as string[];\n\n                for(let childIndex in values) {\n                    // This skips all values that are 0 because the SharedArrayBuffer fills up with zeros.\n                    //TODO(michaschwab): Find a solution for zero values.\n                    if(!values.hasOwnProperty(childIndex)) {\n                        continue;\n                    }\n                    /*if(values[childIndex] === 0) {\n                        continue;\n                    }*/\n                    const index = parseInt(childIndex);\n                    const childNode = this.getNodeFromIndex(index);\n                    if(!childNode) {\n                        console.error('node not found at index', index)\n                        continue;\n                    }\n                    let value: string|number = values[childIndex];\n                    if(attrNameStart === 'style;') {\n                        const styleName = attrName.substr('style;'.length);\n                        const specificityAttrName = 'styleSpecificity;' + styleName;\n                        try {\n                            const matchingSpecificity: number = setAttrQueue[specificityAttrName] ?\n                                setAttrQueue[specificityAttrName][childIndex] : 1000;\n                            this.applyStyleToNodeAndChildren(childNode, styleName, <string> value, matchingSpecificity);\n                            this.updateDeducedStyles(childNode, styleName, <string> value);\n                        } catch (e) {\n                            console.error(e, setAttrQueue, specificityAttrName, childIndex);\n                            this.applyStyleToNodeAndChildren(childNode, styleName, <string> value, -1);\n                        }\n\n                    } else {\n                        if(VdomManager.ROUNDED_ATTRS.indexOf(attrName) !== -1) {\n                            value = Math.round(<number> parseFloat(value));\n                        }\n                        childNode[attrName] = value;\n                        this.updateDeducedStyles(childNode, attrName, <string> value);\n                    }\n                }\n            }\n        }\n    }\n\n    updateDeducedStyles(node: VdomNode, attrName: string, value: string) {\n        if(['opacity', 'fill-opacity', 'stroke-opacity', 'stroke', 'fill'].indexOf(attrName) !== -1) {\n            let stroke = node.style.stroke ? node.style.stroke : node.stroke;\n            if(stroke) {\n                let strokeOpacity = node.style['stroke-opacity'] === undefined ? node.style['opacity']\n                    : node.style['stroke-opacity'];\n                if(strokeOpacity === undefined) {\n                    strokeOpacity = node['stroke-opacity'] === undefined ? node['opacity'] : node['stroke-opacity'];\n                }\n\n                node.style['stroke-rgba'] = DrawingUtils.colorToRgba(stroke, strokeOpacity);\n            }\n        }\n    }\n    \n    private cachedListSelections: {[selector: string]: {[index: number]: VdomNode}} = {};\n    public getVisNodeFromSelector(selector: string): VdomNode|null {\n        const lastSplitPos = selector.lastIndexOf('>');\n        const selectorWithoutLast = selector.substr(0, lastSplitPos);\n        const lastPart = selector.substr(lastSplitPos + 1);\n        const parentSel = selectorWithoutLast ? this.cachedListSelections[selectorWithoutLast] : null;\n        let index = -1;\n        const nthChildPosition = lastPart.indexOf(':nth-child(');\n        if(nthChildPosition !== -1) {\n            index = parseInt(lastPart.substr(nthChildPosition + 11)); // length of ':nth-child('\n            if(parentSel && parentSel[index]) {\n                return parentSel[index];\n            }\n        }\n        \n        const selectedNodes: VdomNode[] = [];\n        this.findMatchingChildren(this.data, selector, 0, selectedNodes);\n        \n        if(selectedNodes && selectedNodes.length === 1) {\n            const el = selectedNodes[0];\n            if(index !== -1) {\n                if(!this.cachedListSelections[selectorWithoutLast]) {\n                    this.cachedListSelections[selectorWithoutLast] = {};\n                }\n                this.cachedListSelections[selectorWithoutLast][index] = el;\n            }\n            return el;\n        }\n        return null;\n    }\n    \n    public getVisNodesFromSelector(visNode: VdomNode, selector: string) {\n        const selectedNodes = [];\n        this.findMatchingChildren(visNode, selector, 0, selectedNodes);\n        return selectedNodes;\n    }\n\n    private findChildrenOfType(visNode: VdomNode, type: string, selectedNodes: VdomNode[]) {\n        const addDirectChildrenIfMatch = (node: VdomNode) => {\n            for(const child of node.children) {\n                if(child.type === type) {\n                    selectedNodes.push(child);\n                }\n                if(node.children.length !== 0) {\n                    addDirectChildrenIfMatch(child);\n                }\n            }\n        };\n        addDirectChildrenIfMatch(visNode);\n    }\n\n    public filterNodesBySelector(parentNode: VdomNode, nodes: VdomNode[], selector: string) {\n        return nodes.filter(node => VdomManager.isCssRulePartialMatch(selector, node, parentNode));\n    }\n    \n    private findMatchingChildren(visNode: VdomNode, selector: string, matchIndex: number, selectedNodes: VdomNode[],\n                                 selectedNodeSelectors: string[] = []) {\n        if(!selector && selector !== '') {\n            console.error(visNode, selector, matchIndex, selectedNodes, selectedNodeSelectors);\n            throw Error('undefined selector');\n        }\n\n        let selParts = selector.split('>').map(s => s.trim());\n        let selPart = selParts[matchIndex];\n        \n        if(matchIndex === 0 && selPart === 'svg') {\n            matchIndex++;\n            selPart = selParts[matchIndex];\n            if(matchIndex === selParts.length) {\n                selectedNodes.push(visNode);\n                selectedNodeSelectors.push(selector);\n                return;\n            }\n        }\n\n        if(selector.match(/^[a-z]+$/)) {\n            return this.findChildrenOfType(visNode, selector, selectedNodes);\n        }\n        \n        for(let i = 0; i < visNode.children.length; i++) {\n            let node = visNode.children[i];\n            let matching = false;\n            \n            if(VdomManager.isCssRulePartialMatch(selPart, node, visNode)) {\n                if(matchIndex === selParts.length - 1) {\n                    selectedNodes.push(node);\n                    selectedNodeSelectors.push(selector);\n                } else {\n                    matching = true;\n                }\n            }\n            \n            if(node.children && (matching || selParts.length < 2) && matchIndex + 1 < selParts.length) {\n                this.findMatchingChildren(node, selector, matchIndex + 1, selectedNodes, selectedNodeSelectors);\n            }\n        }\n    }\n\n    public static isCssRulePartialMatch(cssRuleSelectorPart: string, node: VdomNode, parentNode: VdomNode): boolean {\n        if(cssRuleSelectorPart.substr(0, 5) === ':not(') {\n            const newSelPart = cssRuleSelectorPart.substr(0, cssRuleSelectorPart.length - 1).substr(5);\n            return !VdomManager.isCssRulePartialMatch(newSelPart, node, parentNode);\n        }\n        if(cssRuleSelectorPart[0] === '.') { // Example: .className or .classnameA.classnameB\n            const searchClassNames = cssRuleSelectorPart.split('.');\n            searchClassNames.shift(); // remove empty first string.\n            if(node.className) {\n                let allTrue = true;\n                for(const searchClassName of searchClassNames) {\n                    if(node.className.split(' ').indexOf(searchClassName) === -1) {\n                        allTrue = false;\n                    }\n                }\n                return allTrue;\n            }\n        } else if(cssRuleSelectorPart[0] === '#') { // Example: #id\n            if(cssRuleSelectorPart.substr(1) === node.id) {\n                return true;\n            }\n        } else if(cssRuleSelectorPart.match(/^[a-z]+$/)) { // Example: rect\n            if(cssRuleSelectorPart === node.type) {\n                return true;\n            }\n        } else if(cssRuleSelectorPart.indexOf(':nth-child(') !== -1) {\n            let type = 'any';\n            let indexPart = cssRuleSelectorPart;\n\n            if(cssRuleSelectorPart[0] !== ':') {\n                type = cssRuleSelectorPart.substr(0, cssRuleSelectorPart.indexOf(':'));\n                indexPart = cssRuleSelectorPart.substr(cssRuleSelectorPart.indexOf(':'));\n            }\n\n            const targetIndex = parseInt(indexPart.substr(':nth-child('.length));\n            const index = parentNode.children.indexOf(node);\n\n            return (index === targetIndex - 1 && (type === 'any' || node.type === type));\n        }\n        else if(cssRuleSelectorPart.indexOf('.') !== -1) { // Example: rect.className\n            const cutoff = cssRuleSelectorPart.indexOf('.');\n            const typeName = cssRuleSelectorPart.substr(0, cutoff);\n            const className = cssRuleSelectorPart.substr(cutoff + 1);\n            if(typeName === node.type && node.className && node.className.split(' ').indexOf(className) !== -1) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n\nlet safeLogCount = 0;\nfunction safeLog(...logContents) {\n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.log(...logContents);\n    }\n}\nfunction safeErrorLog(...logContents) {\n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.error(...logContents);\n    }\n}\n","import {VdomNode} from \"../util/vdom/vdom\";\nimport {VdomManager} from \"../util/vdom/vdom-manager\";\nimport DrawingUtils from \"./drawingUtils\";\nimport CanvasWorker from \"./canvasworker\";\n\ntype DrawMode = 'start'|'normal'|'end'|'forcesingle';\n\nexport default class Canvasrenderer implements CanvasWorker {\n    \n    private ctx: CanvasRenderingContext2D;\n    private parentValues: {[prop: string]: string|number} = {};\n    \n    constructor(private vdom: VdomManager, private canvas: HTMLCanvasElement,\n                private forceSingle = false, private onDrawn = () => {}) {\n        const ctx = canvas.getContext('2d');\n        if(!ctx) throw new Error('could not create canvas context');\n        \n        this.ctx = ctx;\n        this.ctx.scale(this.vdom.data.scale, this.vdom.data.scale);\n        this.ctx.save();\n        \n        this.draw();\n        \n        setTimeout(() => {\n            console.log(this.forceSingle, this.vdom.data);\n            this.draw();\n        }, 1000);\n    }\n    \n    private lastFullSecond = 0;\n    private countSinceLastFullSecond = 0;\n    \n    draw() {\n        const ctx = this.ctx;\n        \n        ctx.restore();\n        ctx.save();\n        \n        //ctx.fillStyle = '#fff';\n        //ctx.fillRect(0, 0, this.vdom.data.width, this.vdom.data.height);\n        ctx.clearRect(0, 0, this.vdom.data.width, this.vdom.data.height);\n    \n        //this.lastDrawn = null;\n        this.drawLine(null, 'start');\n        this.drawCircle(null, 'start');\n        this.drawRect(null, 'start');\n        this.drawText(null, 'start');\n        this.drawImage(null, 'start');\n\n        this.drawNodeAndChildren(this.vdom.data, this.forceSingle);\n\n        this.drawLine(null, 'end');\n        this.drawCircle(null, 'end');\n        this.drawRect(null, 'end');\n        this.drawText(null, 'end');\n        this.drawImage(null, 'end');\n        \n        this.onDrawn();\n    \n        const fullSecond = Math.round(performance.now() / 1000);\n        if(fullSecond !== this.lastFullSecond) {\n            this.lastFullSecond = fullSecond;\n            //console.log(this.countSinceLastFullSecond);\n            this.countSinceLastFullSecond = 0;\n        }\n        this.countSinceLastFullSecond++;\n    }\n    \n    private drawNodeAndChildren(elData: VdomNode, forceSingle: boolean, drawClip?: Path2D) {\n        if(elData.type === 'clippath' && !drawClip) {\n            return;\n        }\n\n        const ctx = this.ctx;\n        const parentValuesBackup = {...this.parentValues};\n\n        if(!drawClip) {\n            ctx.save();\n        }\n\n        const hasTransformed = this.applyTransform(elData.transform);\n\n        if(elData.transform || drawClip) {\n            forceSingle = true;\n        }\n\n        if(elData['clip-path']) {\n            if(elData['clip-path'].substr(0, 5) === 'url(#') {\n                const clipPathId = elData['clip-path'].substr(5, elData['clip-path'].length - 6);\n                const clipNode = this.vdom.getNodeById(clipPathId);\n                forceSingle = true;\n\n                if(!clipNode) {\n                    //safeErrorLog('clip node not found', elData['clip-path'], clipPathId, this.vdom.data)\n                } else {\n                    const path = new Path2D();\n                    this.drawNodeAndChildren(clipNode, forceSingle, path);\n                    ctx.clip(path);\n                }\n            } else {\n                safeErrorLog('clip path format not supported:', elData['clip-path']);\n            }\n        }\n\n        if(!elData.style.display || elData.style.display !== 'none') {\n            if(!forceSingle) {\n                this.drawSingleNode(elData, 'normal', drawClip);\n            } else {\n                this.drawSingleNode(elData, 'forcesingle', drawClip);\n            }\n        }\n\n        const fill = this.getFillStyle(elData, 'undefined');\n        if(fill !== 'undefined') {\n            this.parentValues['fill'] = fill;\n        }\n        const stroke = this.getStrokeStyle(elData, 'undefined');\n        if(stroke !== 'undefined') {\n            this.parentValues['stroke'] = stroke;\n        }\n        this.parentValues['opacity'] = elData.opacity;\n\n        if(elData.children) {\n            for(let i = 0; i < elData.children.length; i++) {\n                this.drawNodeAndChildren(elData.children[i], forceSingle, drawClip);\n            }\n        }\n\n        if(!drawClip) {\n            //safeLog('restoring ctx', elData);\n            ctx.restore();\n            this.parentValues = parentValuesBackup;\n        }\n\n        if(hasTransformed) {\n            //ctx.restore();\n        }\n    }\n    \n    private drawSingleNode(elData: VdomNode, mode: DrawMode = 'normal', path?: Path2D) {\n        const type: string = elData.type;\n        const drawFct = this['draw' + type.substr(0,1).toUpperCase() + type.substr(1)];\n        if(!drawFct) {\n            return console.error('no draw function yet for ', type);\n        }\n        drawFct.call(this, elData, mode, path);\n    }\n\n    private drawClippath(elData: VdomNode) {\n        //safeLog('clippaths can not be rendered yet.')\n    }\n\n    private drawSvg() {}\n    private drawTitle() {}\n    private drawG() {}\n    \n    private circlesByColor: {[color: string]: VdomNode[]} = {};\n    private drawCircle(elData: VdomNode, mode: DrawMode = 'normal', path?: Path2D) {\n        if(mode === 'normal') {\n            let fill = this.getFillStyle(elData, '#000');\n            const stroke = this.getStrokeStyle(elData);\n            const handle = fill + ';' + stroke;\n            if(!this.circlesByColor[handle]) {\n                this.circlesByColor[handle] = [];\n            }\n            this.circlesByColor[handle].push(elData);\n        }\n        if(mode === 'start') {\n            this.circlesByColor = {};\n            return;\n        }\n        if(mode === 'end') {\n            for(let fillAndStrokeColor in this.circlesByColor) {\n                if(this.circlesByColor.hasOwnProperty(fillAndStrokeColor)) {\n                    const split = fillAndStrokeColor.split(';');\n                    const fillColor = split[0];\n                    const strokeColor = split[1];\n\n                    this.ctx.fillStyle = fillColor;\n                    let sampleData = this.circlesByColor[fillAndStrokeColor][0];\n                    const lineWidth = this.getStrokeWidth(sampleData);\n                    this.ctx.lineWidth = lineWidth !== undefined ? lineWidth : 1;\n                    this.ctx.strokeStyle = strokeColor;\n\n                    this.ctx.beginPath();\n                    for(let elData of this.circlesByColor[fillAndStrokeColor]) {\n                        const cx = this.vdom.get(elData, 'cx') ? this.vdom.get(elData, 'cx') : 0;\n                        const cy = this.vdom.get(elData, 'cy') ? this.vdom.get(elData, 'cy') : 0;\n                        const r = this.vdom.get(elData, 'r');\n                        this.ctx.save();\n                        this.applyTransform(elData.transform);\n                        this.ctx.moveTo(cx + r, cy);\n                        this.ctx.arc(cx, cy, r, 0, 2 * Math.PI);\n                        this.ctx.restore();\n                        //this.ctx.restore();\n                    }\n\n                    if(fillColor !== 'none'){\n                        this.ctx.fill();\n                    }\n\n                    if(sampleData.style['stroke-rgba'] && sampleData.style['stroke-rgba'] !== 'none') {\n                        this.ctx.stroke();\n                    }\n                }\n            }\n            return;\n        }\n        if(mode === 'forcesingle') {\n            let fill = this.getFillStyle(elData, '#000');\n\n            const cx = this.vdom.get(elData, 'cx') || 0;\n            const cy = this.vdom.get(elData, 'cy') || 0;\n\n            this.ctx.beginPath();\n            this.ctx.fillStyle = fill;\n            this.ctx.strokeStyle = this.getStrokeStyle(elData);\n            this.ctx.lineWidth = this.getStrokeWidth(elData);\n            this.ctx.moveTo(cx + elData.r, cy);\n            const context = path ? path : this.ctx;\n            context.arc(cx, cy, elData.r, 0, 2 * Math.PI);\n            if(fill !== 'none' && !path){\n                this.ctx.fill();\n            }\n\n            if(elData.style['stroke-rgba'] && elData.style['stroke-rgba'] !== 'none' && !path) {\n                this.ctx.stroke();\n            }\n        }\n    }\n\n    private getFillStyle(node: VdomNode, defaultColor = 'none'): string {\n        let fill = node.style.fill ? node.style.fill : node.fill;\n        let opacity = node.opacity || 1;\n        if(node.style['opacity']) {\n            opacity = parseFloat(node.style['opacity']);\n        }\n        if(node['fill-opacity'] || node.style['fill-opacity']) {\n            const fillOp = node['fill-opacity'] ? parseFloat(node['fill-opacity']) :\n                parseFloat(node.style['fill-opacity']);\n            opacity *= fillOp;\n        }\n\n        let defaultCol = '';\n        if(this.parentValues['fill']) {\n            defaultCol = this.parentValues['fill'] as string;\n        }\n        if(this.parentValues['style;fill']) {\n            defaultCol = this.parentValues['style;fill'] as string;\n        }\n        if(!this.parentValues['fill'] && !this.parentValues['style;fill']) {\n            defaultCol = defaultColor;\n        }\n\n        fill = DrawingUtils.colorToRgba(fill, opacity, defaultCol);\n        return fill;\n    }\n\n    private getStrokeStyle(node: VdomNode, defaultColor = 'none'): string {\n        if(node.style['stroke-rgba']) {\n            return node.style['stroke-rgba'];\n        }\n        let stroke = node.style.stroke ? node.style.stroke : node.stroke;\n        if(stroke !== undefined) {\n            let strokeOpacity = node.style['stroke-opacity'] === undefined ? node.style['opacity']\n                : node.style['stroke-opacity'];\n            if(strokeOpacity === undefined) {\n                strokeOpacity = node['stroke-opacity'] === undefined ? node['opacity'] : node['stroke-opacity'];\n            }\n\n            node.style['stroke-rgba'] = DrawingUtils.colorToRgba(stroke, strokeOpacity);\n            return node.style['stroke-rgba'];\n        }\n        return defaultColor;\n    }\n\n    private getStrokeWidth(node: VdomNode) {\n        const width = node.style['stroke-width'] !== undefined ? node.style['stroke-width'] : node['stroke-width'];\n        return width === undefined ? undefined : parseFloat(width);\n    }\n\n    private rectsByColor = {};\n\n    private drawRect(elData: VdomNode, mode: DrawMode = 'normal', path?: Path2D) {\n        if(mode === 'normal') {\n            let fill = this.getFillStyle(elData, '#000');\n            const stroke = this.getStrokeStyle(elData);\n            const handle = fill + ';' + stroke;\n            if(!this.rectsByColor[handle]) {\n                this.rectsByColor[handle] = [];\n            }\n            this.rectsByColor[handle].push(elData);\n        }\n        if(mode === 'start') {\n            this.rectsByColor = {};\n            return;\n        }\n        if(mode === 'end') {\n            for(let fillAndStrokeColor in this.rectsByColor) {\n                if(this.rectsByColor.hasOwnProperty(fillAndStrokeColor)) {\n                    const split = fillAndStrokeColor.split(';');\n                    const fillColor = split[0];\n                    const strokeColor = split[1];\n                    this.ctx.fillStyle = fillColor;\n\n                    let sampleData = this.rectsByColor[fillAndStrokeColor][0];\n                    const lineWidth = this.getStrokeWidth(sampleData);\n                    this.ctx.lineWidth = lineWidth !== undefined ? lineWidth : 1;\n                    this.ctx.strokeStyle = strokeColor;\n\n                    this.ctx.beginPath();\n                    for(let elData of this.rectsByColor[fillAndStrokeColor]) {\n                        const x = this.vdom.get(elData, 'x') || 0;\n                        const y = this.vdom.get(elData, 'y') || 0;\n                        this.ctx.save();\n                        this.applyTransform(elData.transform);\n                        this.ctx.moveTo(x, y);\n                        this.ctx.rect(x, y, elData.width, elData.height);\n                        this.ctx.restore();\n                        //this.ctx.restore();\n                    }\n                    if(fillColor !== 'none'){\n                        this.ctx.fill();\n                    }\n\n                    if(sampleData.style['stroke-rgba'] && sampleData.style['stroke-rgba'] !== 'none') {\n                        this.ctx.stroke();\n                    }\n                }\n            }\n            return;\n        }\n        if(mode === 'forcesingle') {\n            let fill = this.getFillStyle(elData, '#000');\n            const stroke = this.getStrokeStyle(elData);\n\n            const x = this.vdom.get(elData, 'x') || 0;\n            const y = this.vdom.get(elData, 'y') || 0;\n\n            if(fill && fill !== 'none' && !path) {\n                this.ctx.fillStyle = fill;\n                this.ctx.fillRect(x, y, elData.width, elData.height);\n            }\n            if(path) {\n                path.rect(x, y, elData.width, elData.height);\n            }\n\n            if(stroke !== undefined && !path) {\n                this.ctx.strokeStyle = stroke;\n                this.ctx.beginPath();\n                this.ctx.rect(x, y, elData.width, elData.height);\n                this.ctx.stroke();\n            }\n        }\n    }\n\n    private drawTexts: VdomNode[] = [];\n\n    private drawText(node: VdomNode, mode: DrawMode = 'normal', isClip = false) {\n        const drawSingle = (elData: VdomNode) => {\n            if(elData.text === '') {\n                return;\n            }\n            let fontFamily = 'Times New Roman';\n            if(elData['font-family']) {\n                fontFamily = elData['font-family'];\n            }\n            if(elData.style['font-family']) {\n                fontFamily = elData.style['font-family'];\n            }\n            let fontSize = '16px';\n            if(elData['font-size']) {\n                fontSize = DrawingUtils.convertSizeToPx(elData['font-size']) + 'px';\n            }\n            if(elData.style['font-size']) {\n                fontSize = DrawingUtils.convertSizeToPx(elData.style['font-size']) + 'px';\n            }\n            let font = elData.style['font'] ? elData.style['font'] : elData['font'];\n            if(!font) {\n                font = fontSize + ' ' + fontFamily;\n            }\n            let align = elData['text-anchor'] !== undefined ? elData['text-anchor'] : elData.style['text-anchor'];\n            if(align) {\n                if(align === 'middle') {\n                    align = 'center';\n                }\n                this.ctx.textAlign = align;\n            }\n            let fill = elData['fill'] ? elData['fill'] : elData.style['fill'];\n            if(!fill) fill = '#000';\n            this.ctx.font = font;\n            this.ctx.fillStyle = fill;\n            let x = this.vdom.get(elData, 'x') || 0;\n            let y = this.vdom.get(elData, 'y') || 0;\n            let dx = DrawingUtils.convertSizeToPx(elData.dx, false) || 0;\n            let dy = DrawingUtils.convertSizeToPx(elData.dy, false) || 0;\n            this.ctx.fillText(elData.text, x + dx, y + dy);\n        };\n        if(mode === 'start') {\n            this.drawTexts = [];\n            return;\n        }\n        if(mode === 'normal') {\n            this.drawTexts.push(node);\n            return;\n        }\n        if(mode === 'forcesingle') {\n            return drawSingle(node);\n        }\n        if(mode === 'end') {\n            for(const currentNode of this.drawTexts) {\n                drawSingle(currentNode);\n            }\n            return;\n        }\n    }\n\n    private drawImages: VdomNode[] = [];\n\n    private drawImage(node: VdomNode, mode: DrawMode = 'normal') {\n        const drawSingle = (elData: VdomNode) => {\n            if(elData.href === '') {\n                return;\n            }\n            let fill = elData['fill'] ? elData['fill'] : elData.style['fill'];\n            if(!fill) fill = '#000';\n            this.ctx.fillStyle = fill;\n            let x = this.vdom.get(elData, 'x') || 0;\n            let y = this.vdom.get(elData, 'y') || 0;\n            let width = elData.width || 0;\n            let height = elData.height || 0;\n            if(elData.image) {\n                try {\n                    this.ctx.drawImage(elData.image, x, y, width, height);\n                } catch(e) {\n                    console.log(e);\n                }\n            }\n        };\n        if(mode === 'start') {\n            this.drawImages = [];\n            return;\n        }\n        if(mode === 'normal') {\n            this.drawImages.push(node);\n            return;\n        }\n        if(mode === 'forcesingle') {\n            return drawSingle(node);\n        }\n        if(mode === 'end') {\n            for(const currentNode of this.drawImages) {\n                drawSingle(currentNode);\n            }\n            return;\n        }\n    }\n\n    private drawPath(elData: VdomNode, mode: DrawMode = 'normal', path?: Path2D) {\n        if(mode !== 'normal' && mode !== 'forcesingle') return;\n\n        const fill = this.getFillStyle(elData, '#000');\n        const stroke = this.getStrokeStyle(elData);\n        const strokeWidth = this.getStrokeWidth(elData);\n\n        let p = new Path2D(elData.d);\n        this.ctx.fillStyle = fill;\n        if(stroke !== undefined && stroke !== 'none') {\n            if(strokeWidth !== undefined) {\n                this.ctx.lineWidth = strokeWidth;\n            }\n            this.ctx.strokeStyle = stroke;\n\n            if(elData.style['stroke-linejoin']) {\n                const lineJoin = elData.style['stroke-linejoin'];\n                if(lineJoin === 'bevel' || lineJoin === 'round' || lineJoin === 'miter') {\n                    this.ctx.lineJoin = lineJoin;\n                } else {\n                    console.error('unknown line join value:', lineJoin)\n                }\n            }\n            if(!path) {\n                this.ctx.stroke(p);\n            }\n        }\n\n        if(fill && fill !== 'none' && !path) {\n            this.ctx.fill(p);\n        }\n        if(path) {\n            path.addPath(p);\n        }\n    }\n    \n    private drawTspan(elData: VdomNode, mode: DrawMode = 'normal') {\n        if(mode !== 'normal' && mode !== 'forcesingle') return;\n        \n        this.ctx.font = \"10px Arial\";\n        this.ctx.fillStyle = \"#000000\";\n        const textAlign = <CanvasTextAlign> (elData.style.textAnchor === \"middle\" ? \"center\" : elData.style.textAnchor);\n        this.ctx.textAlign = textAlign;\n        this.ctx.fillText(elData.text, this.vdom.get(elData, 'x'), this.vdom.get(elData, 'y'));\n    }\n\n    private drawTextpath(elData: VdomNode) {\n        console.warn('no draw function yet for textpath');\n    }\n\n    private linesByColor: {[color: string]: VdomNode[]} = {};\n    private drawLine(elData, mode: DrawMode = 'normal') {\n        if(this.vdom.data.scale > 1) {\n            //mode = 'forcesingle';\n            // In my tests, drawing a long connected path is very slow for high DPI devices.\n        }\n        if(mode === 'normal') {\n            const stroke = this.getStrokeStyle(elData);\n            const width = this.getStrokeWidth(elData);\n            if(stroke === 'none' || width === 0) {\n                return;\n            }\n            const selector = `${stroke};${width}`;\n            if(!this.linesByColor[selector]) {\n                this.linesByColor[selector] = [];\n            }\n            this.linesByColor[selector].push(elData);\n        }\n        if(mode === 'start') {\n            this.linesByColor = {};\n            return;\n        }\n        if(mode === 'end') {\n            //safeLog(Object.keys(this.linesByColor), this.linesByColor);\n            for(let selector in this.linesByColor) {\n                if(this.linesByColor.hasOwnProperty(selector)) {\n                    const split = selector.split(';');\n                    const strokeColor = split[0];\n                    const width = split[1];\n\n                    this.ctx.strokeStyle = strokeColor;\n                    this.ctx.lineWidth = parseFloat(width);\n\n                    this.ctx.beginPath();\n                    for(let elData of this.linesByColor[selector]) {\n                        if(elData.transform) {\n                            this.ctx.save();\n                            this.applyTransform(elData.transform);\n                        }\n\n                        this.ctx.moveTo(this.vdom.get(elData, 'x1') || 0, this.vdom.get(elData, 'y1') || 0);\n                        this.ctx.lineTo(this.vdom.get(elData, 'x2') || 0, this.vdom.get(elData, 'y2') || 0);\n\n                        if(elData.transform) {\n                            //this.ctx.restore();\n                            this.ctx.restore();\n                        }\n                    }\n\n                    this.ctx.stroke();\n                }\n            }\n            return;\n        }\n        if(mode === 'forcesingle') {\n            this.ctx.beginPath();\n            this.ctx.moveTo(this.vdom.get(elData, 'x1') || 0, this.vdom.get(elData, 'y1') || 0);\n            this.ctx.lineTo(this.vdom.get(elData, 'x2') || 0, this.vdom.get(elData, 'y2') || 0);\n\n            this.ctx.strokeStyle = this.getStrokeStyle(elData);\n            this.ctx.lineWidth = this.getStrokeWidth(elData);\n            //safeLog(stroke, this.ctx.strokeStyle);\n            this.ctx.stroke();\n        }\n    }\n\n    private drawDefs(node: VdomNode) {\n        //TODO figure out.\n    }\n\n    private drawMarker(node: VdomNode) {\n        //TODO figure out.\n    }\n    \n    private applyTransform(transformString: string) {\n        const transform = transformString ? DrawingUtils.parseTransform(transformString) : null;\n        if(transform) {\n            if(transform.rotate) {\n                //console.log(transform.rotate);\n            }\n            //console.log(transformString);\n            this.ctx.rotate(transform.rotate * Math.PI / 180);\n            const x = transform.translateBeforeScale ? transform.translateX : transform.translateX * transform.scaleX;\n            const y = transform.translateBeforeScale ? transform.translateY : transform.translateY * transform.scaleY;\n            this.ctx.transform(transform.scaleX, 0, 0, transform.scaleY, x, y);\n            //ctx.rotate(transform.rotate / 2 / Math.PI);\n\n            //console.log(transform.rotate);\n            return true;\n        }\n        return false;\n    }\n}\n\n\nlet safeLogCount = 0;\nfunction safeLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.log(...logContents);\n    }\n}\nfunction safeErrorLog(...logContents) {\n    \n    if(safeLogCount < 50) {\n        safeLogCount++;\n        console.error(...logContents);\n    }\n}\n","import './custom';\nimport CanvasWorkerImporter = require('worker-loader?inline=true!./canvasworker');\n\nexport default CanvasWorkerImporter;","module.exports = function() {\n  return require(\"!!/home/micha/WebstormProjects/ssvg/node_modules/worker-loader/dist/workers/InlineWorker.js\")(\"!function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){\\\"undefined\\\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\\\"Module\\\"}),Object.defineProperty(t,\\\"__esModule\\\",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&\\\"object\\\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,\\\"default\\\",{enumerable:!0,value:t}),2&e&&\\\"string\\\"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,\\\"a\\\",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p=\\\"\\\",s(s.s=1)}([function(t,e,s){\\\"use strict\\\";Object.defineProperty(e,\\\"__esModule\\\",{value:!0});class r{static parseTransform(t){const e={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0,translateBeforeScale:!1};if(t){if(\\\"string\\\"!=typeof t)return e.scaleX=t.k,e.scaleY=t.k,e.translateX=t.x,e.translateY=t.y,e;let s=t;s=s.replace(/ /g,\\\"\\\");const r=/\\\\s*translate\\\\(([-0-9.]+),([-0-9.]+)\\\\)/.exec(s);r&&(e.translateX=parseFloat(r[1]),e.translateY=parseFloat(r[2]));const i=/\\\\s*scale\\\\(([-0-9.]+)(,[-0-9.]+)?\\\\)/.exec(s);i&&(e.scaleX=parseFloat(i[1]),e.scaleY=i[2]?parseFloat(i[2].substr(1)):parseFloat(i[1]));const o=/\\\\s*rotate\\\\(([-0-9.]+)\\\\)/.exec(s);o&&(e.rotate=parseFloat(o[1])),/\\\\s*translate\\\\(([-0-9.]+),([-0-9.]+)\\\\)scale\\\\(([-0-9.,]+)\\\\)/.exec(s)&&(e.translateBeforeScale=!0);const l=/\\\\s*matrix\\\\(([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+),([-0-9.]+)\\\\)/.exec(s);l&&(e.scaleX=parseFloat(l[1]),e.scaleY=parseFloat(l[4]),e.translateX=parseFloat(l[5]),e.translateY=parseFloat(l[6]))}return e}static addTransforms(t,e){return{translateX:t.translateX+e.translateX,translateY:t.translateY+e.translateY,scaleX:t.scaleX*e.scaleX,scaleY:t.scaleY*e.scaleY,rotate:t.rotate+e.rotate,translateBeforeScale:!1}}static convertSizeToPx(t,e=!0){const s=e?14:void 0;return void 0===t?s:\\\"number\\\"==typeof t?t:\\\"em\\\"===t.substr(-2)?Math.round(12*parseFloat(t)):\\\"px\\\"===t.substr(-2)?parseInt(t):t.match(/^[0-9]+$/)?parseInt(t):(console.warn(\\\"size in unsupported format: \\\",t),s)}static colorToRgba(t,e=1,s=\\\"none\\\"){if(\\\"none\\\"===t)return t;if(t||(t=s),t=r.CssNamedColorToHex(t),1===e&&\\\"string\\\"==typeof t)return t;if(\\\"string\\\"==typeof t&&\\\"#\\\"===t[0]){let s;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return s=t.substring(1),3==s.length&&(s=s[0]+s[0]+s[1]+s[1]+s[2]+s[2]),s=\\\"0x\\\"+s,\\\"rgba(\\\"+[s>>16&255,s>>8&255,255&s].join(\\\",\\\")+\\\",\\\"+e+\\\")\\\";throw new Error(\\\"Bad Hex\\\")}if(\\\"object\\\"==typeof t){if(\\\"r\\\"in t)return\\\"rgba(\\\"+t.r+\\\",\\\"+t.g+\\\",\\\"+t.b+\\\",\\\"+e+\\\")\\\";if(\\\"h\\\"in t){const s=r.hslToRgb(t.h/360,t.s,t.l);return\\\"rgba(\\\"+s.r+\\\",\\\"+s.g+\\\",\\\"+s.b+\\\",\\\"+e+\\\")\\\"}}else if(\\\"rgb(\\\"===t.substr(0,4))return t.substr(0,t.length-1).replace(\\\"rgb\\\",\\\"rgba\\\")+\\\", \\\"+e+\\\")\\\";return t}static hslToRgb(t,e,s){var r,i,o;if(0==e)r=i=o=s;else{var l=function(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t},n=s<.5?s*(1+e):s+e-s*e,a=2*s-n;r=l(a,n,t+1/3),i=l(a,n,t),o=l(a,n,t-1/3)}return{r:Math.round(255*r),g:Math.round(255*i),b:Math.round(255*o)}}static CssNamedColorToHex(t){return\\\"string\\\"==typeof t&&i[t.toUpperCase()]?i[t.toUpperCase()]:t}static getCssRuleSpecificityNumber(t){let e=0;t=t.replace(/ >/g,\\\">\\\").replace(/> /g,\\\">\\\");const s=[].concat.apply([],t.split(\\\" \\\").map(t=>t.split(\\\">\\\")));for(const t of s){e+=100;const s=t[0];if(\\\"#\\\"===s)e+=1e3;else if(\\\".\\\"===s){const s=t.split(\\\".\\\").length-1;e+=Math.min(900,100*s)}}return e}}e.default=r;const i={ALICEBLUE:\\\"#F0F8FF\\\",ANTIQUEWHITE:\\\"#FAEBD7\\\",AQUA:\\\"#00FFFF\\\",AQUAMARINE:\\\"#7FFFD4\\\",AZURE:\\\"#F0FFFF\\\",BEIGE:\\\"#F5F5DC\\\",BISQUE:\\\"#FFE4C4\\\",BLACK:\\\"#000000\\\",BLANCHEDALMOND:\\\"#FFEBCD\\\",BLUE:\\\"#0000FF\\\",BLUEVIOLET:\\\"#8A2BE2\\\",BROWN:\\\"#A52A2A\\\",BURLYWOOD:\\\"#DEB887\\\",CADETBLUE:\\\"#5F9EA0\\\",CHARTREUSE:\\\"#7FFF00\\\",CHOCOLATE:\\\"#D2691E\\\",CORAL:\\\"#FF7F50\\\",CORNFLOWERBLUE:\\\"#6495ED\\\",CORNSILK:\\\"#FFF8DC\\\",CRIMSON:\\\"#DC143C\\\",CYAN:\\\"#00FFFF\\\",DARKBLUE:\\\"#00008B\\\",DARKCYAN:\\\"#008B8B\\\",DARKGOLDENROD:\\\"#B8860B\\\",DARKGRAY:\\\"#A9A9A9\\\",DARKGREY:\\\"#A9A9A9\\\",DARKGREEN:\\\"#006400\\\",DARKKHAKI:\\\"#BDB76B\\\",DARKMAGENTA:\\\"#8B008B\\\",DARKOLIVEGREEN:\\\"#556B2F\\\",DARKORANGE:\\\"#FF8C00\\\",DARKORCHID:\\\"#9932CC\\\",DARKRED:\\\"#8B0000\\\",DARKSALMON:\\\"#E9967A\\\",DARKSEAGREEN:\\\"#8FBC8F\\\",DARKSLATEBLUE:\\\"#483D8B\\\",DARKSLATEGRAY:\\\"#2F4F4F\\\",DARKSLATEGREY:\\\"#2F4F4F\\\",DARKTURQUOISE:\\\"#00CED1\\\",DARKVIOLET:\\\"#9400D3\\\",DEEPPINK:\\\"#FF1493\\\",DEEPSKYBLUE:\\\"#00BFFF\\\",DIMGRAY:\\\"#696969\\\",DIMGREY:\\\"#696969\\\",DODGERBLUE:\\\"#1E90FF\\\",FIREBRICK:\\\"#B22222\\\",FLORALWHITE:\\\"#FFFAF0\\\",FORESTGREEN:\\\"#228B22\\\",FUCHSIA:\\\"#FF00FF\\\",GAINSBORO:\\\"#DCDCDC\\\",GHOSTWHITE:\\\"#F8F8FF\\\",GOLD:\\\"#FFD700\\\",GOLDENROD:\\\"#DAA520\\\",GRAY:\\\"#808080\\\",GREY:\\\"#808080\\\",GREEN:\\\"#008000\\\",GREENYELLOW:\\\"#ADFF2F\\\",HONEYDEW:\\\"#F0FFF0\\\",HOTPINK:\\\"#FF69B4\\\",INDIANRED:\\\"#CD5C5C\\\",INDIGO:\\\"#4B0082\\\",IVORY:\\\"#FFFFF0\\\",KHAKI:\\\"#F0E68C\\\",LAVENDER:\\\"#E6E6FA\\\",LAVENDERBLUSH:\\\"#FFF0F5\\\",LAWNGREEN:\\\"#7CFC00\\\",LEMONCHIFFON:\\\"#FFFACD\\\",LIGHTBLUE:\\\"#ADD8E6\\\",LIGHTCORAL:\\\"#F08080\\\",LIGHTCYAN:\\\"#E0FFFF\\\",LIGHTGOLDENRODYELLOW:\\\"#FAFAD2\\\",LIGHTGRAY:\\\"#D3D3D3\\\",LIGHTGREY:\\\"#D3D3D3\\\",LIGHTGREEN:\\\"#90EE90\\\",LIGHTPINK:\\\"#FFB6C1\\\",LIGHTSALMON:\\\"#FFA07A\\\",LIGHTSEAGREEN:\\\"#20B2AA\\\",LIGHTSKYBLUE:\\\"#87CEFA\\\",LIGHTSLATEGRAY:\\\"#778899\\\",LIGHTSLATEGREY:\\\"#778899\\\",LIGHTSTEELBLUE:\\\"#B0C4DE\\\",LIGHTYELLOW:\\\"#FFFFE0\\\",LIME:\\\"#00FF00\\\",LIMEGREEN:\\\"#32CD32\\\",LINEN:\\\"#FAF0E6\\\",MAGENTA:\\\"#FF00FF\\\",MAROON:\\\"#800000\\\",MEDIUMAQUAMARINE:\\\"#66CDAA\\\",MEDIUMBLUE:\\\"#0000CD\\\",MEDIUMORCHID:\\\"#BA55D3\\\",MEDIUMPURPLE:\\\"#9370DB\\\",MEDIUMSEAGREEN:\\\"#3CB371\\\",MEDIUMSLATEBLUE:\\\"#7B68EE\\\",MEDIUMSPRINGGREEN:\\\"#00FA9A\\\",MEDIUMTURQUOISE:\\\"#48D1CC\\\",MEDIUMVIOLETRED:\\\"#C71585\\\",MIDNIGHTBLUE:\\\"#191970\\\",MINTCREAM:\\\"#F5FFFA\\\",MISTYROSE:\\\"#FFE4E1\\\",MOCCASIN:\\\"#FFE4B5\\\",NAVAJOWHITE:\\\"#FFDEAD\\\",NAVY:\\\"#000080\\\",OLDLACE:\\\"#FDF5E6\\\",OLIVE:\\\"#808000\\\",OLIVEDRAB:\\\"#6B8E23\\\",ORANGE:\\\"#FFA500\\\",ORANGERED:\\\"#FF4500\\\",ORCHID:\\\"#DA70D6\\\",PALEGOLDENROD:\\\"#EEE8AA\\\",PALEGREEN:\\\"#98FB98\\\",PALETURQUOISE:\\\"#AFEEEE\\\",PALEVIOLETRED:\\\"#DB7093\\\",PAPAYAWHIP:\\\"#FFEFD5\\\",PEACHPUFF:\\\"#FFDAB9\\\",PERU:\\\"#CD853F\\\",PINK:\\\"#FFC0CB\\\",PLUM:\\\"#DDA0DD\\\",POWDERBLUE:\\\"#B0E0E6\\\",PURPLE:\\\"#800080\\\",REBECCAPURPLE:\\\"#663399\\\",RED:\\\"#FF0000\\\",ROSYBROWN:\\\"#BC8F8F\\\",ROYALBLUE:\\\"#4169E1\\\",SADDLEBROWN:\\\"#8B4513\\\",SALMON:\\\"#FA8072\\\",SANDYBROWN:\\\"#F4A460\\\",SEAGREEN:\\\"#2E8B57\\\",SEASHELL:\\\"#FFF5EE\\\",SIENNA:\\\"#A0522D\\\",SILVER:\\\"#C0C0C0\\\",SKYBLUE:\\\"#87CEEB\\\",SLATEBLUE:\\\"#6A5ACD\\\",SLATEGRAY:\\\"#708090\\\",SLATEGREY:\\\"#708090\\\",SNOW:\\\"#FFFAFA\\\",SPRINGGREEN:\\\"#00FF7F\\\",STEELBLUE:\\\"#4682B4\\\",TAN:\\\"#D2B48C\\\",TEAL:\\\"#008080\\\",THISTLE:\\\"#D8BFD8\\\",TOMATO:\\\"#FF6347\\\",TURQUOISE:\\\"#40E0D0\\\",VIOLET:\\\"#EE82EE\\\",WHEAT:\\\"#F5DEB3\\\",WHITE:\\\"#FFFFFF\\\",WHITESMOKE:\\\"#F5F5F5\\\",YELLOW:\\\"#FFFF00\\\",YELLOWGREEN:\\\"#9ACD32\\\"}},function(t,e,s){\\\"use strict\\\";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\\\"__esModule\\\",{value:!0});const i=s(2),o=r(s(3));let l;const n=self;let a;n.onmessage=function(t){const e=t.data;if(e&&e.cmd)switch(e.cmd){case\\\"INIT\\\":a=new i.VdomManager(e.data.visData,!1);const t=!!e.data.safeMode;l=new o.default(a,e.data.canvas,t,()=>{n.postMessage({msg:\\\"DRAWN\\\"})});break;case\\\"UPDATE_NODES\\\":const s=e;for(let t of s.data.enterExit)\\\"ENTER\\\"===t.cmd?(t.keepChildren||(t.node.children=[]),a.addNode(t.node),a.addNodeToParent(t.node,t.parentGlobalIndex),l.addNode&&l.addNode(t.node)):\\\"EXIT\\\"===t.cmd&&a.removeNode(t.childIndex,t.parentGlobalIndex);l.updatePropertiesFromQueue?l.updatePropertiesFromQueue(s.data.update):a.updatePropertiesFromQueue(s.data.update),l.draw();break;default:console.error(\\\"did not find command \\\",e.cmd)}}},function(t,e,s){\\\"use strict\\\";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\\\"__esModule\\\",{value:!0});const i=r(s(0));class o{constructor(t,e){this.data=t,this.ignoreDesign=e,this.sharedData={},this.queue={},this.useSharedArrayFor=[\\\"cx\\\",\\\"cy\\\",\\\"x1\\\",\\\"x2\\\",\\\"y1\\\",\\\"y2\\\",\\\"x\\\",\\\"y\\\"],this.indexToNodeMap={},this.cachedListSelections={},this.ensureNodesMapped()}ensureInitialized(t,e,s){if(\\\"class\\\"===t&&(t=\\\"className\\\"),e&&-1!==this.useSharedArrayFor.indexOf(t))if(this.sharedData[t]){const e=s<500?1e3:2*s,r=Int32Array.BYTES_PER_ELEMENT*e;if(this.sharedData[t].byteLength/r<.8){const e=new SharedArrayBuffer(r),s=new Int32Array(e),i=new Int32Array(this.sharedData[t]);for(const t in i)s[t]=i[t];this.queue[t]=e,this.sharedData[t]=s}}else{const e=s<500?1e3:2*s,r=new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT*e),i=new Int32Array(r);if(this.queue[t]&&!(this.queue[t]instanceof SharedArrayBuffer)){this.queue[t].forEach((t,e)=>{i[e]=parseFloat(t)*o.BUFFER_PRECISION_FACTOR})}this.queue[t]=r,this.sharedData[t]=i}else this.queue[t]||(this.queue[t]=[])}set(t,e,s,r){if(\\\"class\\\"===e&&(e=\\\"className\\\"),void 0===t.globalElementIndex)throw console.error(\\\"No index\\\",t),new Error(\\\"Element has no index\\\");const i=t.globalElementIndex,l=r&&-1!==this.useSharedArrayFor.indexOf(e)?\\\"shared\\\":\\\"raw\\\";try{\\\"shared\\\"===l?(0===(s*=o.BUFFER_PRECISION_FACTOR)&&(s=133713371337),this.sharedData[e][i]=s):(this.queue[e][i]=s,this.sharedData[e]&&this.sharedData[e][i]&&(this.sharedData[e][i]=0))}catch(s){console.error(s),console.log(this.queue,this.sharedData,l,e,t,i)}}ensureNodesMapped(){const t=e=>{void 0===e.globalElementIndex&&console.error(\\\"no element index\\\",e),this.indexToNodeMap[e.globalElementIndex]=e;for(const s of e.children)t(s)};t(this.data)}enableFrontendDesignProperties(){this.ignoreDesign=!1}addNodeToParent(t,e){let s=this.getNodeFromIndex(e);if(!s)return console.error(\\\"could not add node without parent\\\",e,t,Object.keys(this.indexToNodeMap)),void new Error(\\\"parent not found\\\");this.applyParentStyles(s,t),s.children.push(t)}addNode(t){this.indexToNodeMap[t.globalElementIndex]=t}removeNode(t,e){this.getNodeFromIndex(e).children.splice(t,1),this.cachedListSelections={}}applyParentStyles(t,e){for(const s in t.style)e.style[s]||(e.style[s]=t.style[s])}getParentNodeFromSelector(t){let e;return t||console.error(\\\"no parent selector\\\",t),e=\\\"SVG_PARENT\\\"===t?{children:[this.data]}:this.getVisNodeFromSelector(t),e||console.error(\\\"parent node not found with selector\\\",t),e}applyStyleToNodeAndChildren(t,e,s,r){if((!t.styleSpecificity[e]||t.styleSpecificity[e]<=r)&&(t.style[e]=s,t.styleSpecificity[e]=r),t.children)for(let i of t.children)this.applyStyleToNodeAndChildren(i,e,s,r)}getNodeFromIndex(t){return this.indexToNodeMap[t]}getNodeById(t){const e=Object.values(this.indexToNodeMap).filter(e=>e.id===t);return(!e||e.length>1)&&(n(\\\"multiple nodes with this id!\\\",Object.values(this.indexToNodeMap).filter(t=>t.id).map(t=>t.id),t),n(e.length,e)),e&&1===e.length?e[0]:null}get(t,e){return this.sharedData[e]&&this.sharedData[e][t.globalElementIndex]?133713371337===this.sharedData[e][t.globalElementIndex]?0:this.sharedData[e][t.globalElementIndex]/o.BUFFER_PRECISION_FACTOR:t[e]}getQueueValue(t,e){return this.queue[e][t.globalElementIndex]}getQueue(){return this.queue}clearQueue(){this.queue={}}updatePropertiesFromQueue(t){for(let e in t){if(!t.hasOwnProperty(e))continue;const s=e.substr(0,\\\"style;\\\".length);if(this.ignoreDesign&&(\\\"style;\\\"===s||-1!==o.IGNOREDESIGN_ATTRIBUTES.indexOf(e)))continue;let r;if(\\\"SharedArrayBuffer\\\"in self&&t[e]instanceof SharedArrayBuffer)this.sharedData[e]=new Int32Array(t[e]);else{r=t[e];for(let i in r){if(!r.hasOwnProperty(i))continue;const l=parseInt(i),n=this.getNodeFromIndex(l);if(!n){console.error(\\\"node not found at index\\\",l);continue}let a=r[i];if(\\\"style;\\\"===s){const s=e.substr(\\\"style;\\\".length),r=\\\"styleSpecificity;\\\"+s;try{const e=t[r]?t[r][i]:1e3;this.applyStyleToNodeAndChildren(n,s,a,e),this.updateDeducedStyles(n,s,a)}catch(e){console.error(e,t,r,i),this.applyStyleToNodeAndChildren(n,s,a,-1)}}else-1!==o.ROUNDED_ATTRS.indexOf(e)&&(a=Math.round(parseFloat(a))),n[e]=a,this.updateDeducedStyles(n,e,a)}}}}updateDeducedStyles(t,e,s){if(-1!==[\\\"opacity\\\",\\\"fill-opacity\\\",\\\"stroke-opacity\\\",\\\"stroke\\\",\\\"fill\\\"].indexOf(e)){let e=t.style.stroke?t.style.stroke:t.stroke;if(e){let s=void 0===t.style[\\\"stroke-opacity\\\"]?t.style.opacity:t.style[\\\"stroke-opacity\\\"];void 0===s&&(s=void 0===t[\\\"stroke-opacity\\\"]?t.opacity:t[\\\"stroke-opacity\\\"]),t.style[\\\"stroke-rgba\\\"]=i.default.colorToRgba(e,s)}}}getVisNodeFromSelector(t){const e=t.lastIndexOf(\\\">\\\"),s=t.substr(0,e),r=t.substr(e+1),i=s?this.cachedListSelections[s]:null;let o=-1;const l=r.indexOf(\\\":nth-child(\\\");if(-1!==l&&(o=parseInt(r.substr(l+11)),i&&i[o]))return i[o];const n=[];if(this.findMatchingChildren(this.data,t,0,n),n&&1===n.length){const t=n[0];return-1!==o&&(this.cachedListSelections[s]||(this.cachedListSelections[s]={}),this.cachedListSelections[s][o]=t),t}return null}getVisNodesFromSelector(t,e){const s=[];return this.findMatchingChildren(t,e,0,s),s}findChildrenOfType(t,e,s){const r=t=>{for(const i of t.children)i.type===e&&s.push(i),0!==t.children.length&&r(i)};r(t)}filterNodesBySelector(t,e,s){return e.filter(e=>o.isCssRulePartialMatch(s,e,t))}findMatchingChildren(t,e,s,r,i=[]){if(!e&&\\\"\\\"!==e)throw console.error(t,e,s,r,i),Error(\\\"undefined selector\\\");let l=e.split(\\\">\\\").map(t=>t.trim()),n=l[s];if(0===s&&\\\"svg\\\"===n&&(n=l[++s],s===l.length))return r.push(t),void i.push(e);if(e.match(/^[a-z]+$/))return this.findChildrenOfType(t,e,r);for(let a=0;a<t.children.length;a++){let c=t.children[a],h=!1;o.isCssRulePartialMatch(n,c,t)&&(s===l.length-1?(r.push(c),i.push(e)):h=!0),c.children&&(h||l.length<2)&&s+1<l.length&&this.findMatchingChildren(c,e,s+1,r,i)}}static isCssRulePartialMatch(t,e,s){if(\\\":not(\\\"===t.substr(0,5)){const r=t.substr(0,t.length-1).substr(5);return!o.isCssRulePartialMatch(r,e,s)}if(\\\".\\\"===t[0]){const s=t.split(\\\".\\\");if(s.shift(),e.className){let t=!0;for(const r of s)-1===e.className.split(\\\" \\\").indexOf(r)&&(t=!1);return t}}else if(\\\"#\\\"===t[0]){if(t.substr(1)===e.id)return!0}else if(t.match(/^[a-z]+$/)){if(t===e.type)return!0}else{if(-1!==t.indexOf(\\\":nth-child(\\\")){let r=\\\"any\\\",i=t;\\\":\\\"!==t[0]&&(r=t.substr(0,t.indexOf(\\\":\\\")),i=t.substr(t.indexOf(\\\":\\\")));const o=parseInt(i.substr(\\\":nth-child(\\\".length));return s.children.indexOf(e)===o-1&&(\\\"any\\\"===r||e.type===r)}if(-1!==t.indexOf(\\\".\\\")){const s=t.indexOf(\\\".\\\"),r=t.substr(0,s),i=t.substr(s+1);if(r===e.type&&e.className&&-1!==e.className.split(\\\" \\\").indexOf(i))return!0}}return!1}}e.VdomManager=o,o.IGNOREDESIGN_ATTRIBUTES=[\\\"fill\\\",\\\"stroke\\\",\\\"opacity\\\"],o.BUFFER_PRECISION_FACTOR=10,o.ROUNDED_ATTRS=[\\\"cx\\\",\\\"cy\\\"];let l=0;function n(...t){l<50&&(l++,console.log(...t))}},function(t,e,s){\\\"use strict\\\";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,\\\"__esModule\\\",{value:!0});const i=r(s(0));e.default=class{constructor(t,e,s=!1,r=(()=>{})){this.vdom=t,this.canvas=e,this.forceSingle=s,this.onDrawn=r,this.parentValues={},this.lastFullSecond=0,this.countSinceLastFullSecond=0,this.circlesByColor={},this.rectsByColor={},this.drawTexts=[],this.drawImages=[],this.linesByColor={};const i=e.getContext(\\\"2d\\\");if(!i)throw new Error(\\\"could not create canvas context\\\");this.ctx=i,this.ctx.scale(this.vdom.data.scale,this.vdom.data.scale),this.ctx.save(),this.draw(),setTimeout(()=>{console.log(this.forceSingle,this.vdom.data),this.draw()},1e3)}draw(){const t=this.ctx;t.restore(),t.save(),t.clearRect(0,0,this.vdom.data.width,this.vdom.data.height),this.drawLine(null,\\\"start\\\"),this.drawCircle(null,\\\"start\\\"),this.drawRect(null,\\\"start\\\"),this.drawText(null,\\\"start\\\"),this.drawImage(null,\\\"start\\\"),this.drawNodeAndChildren(this.vdom.data,this.forceSingle),this.drawLine(null,\\\"end\\\"),this.drawCircle(null,\\\"end\\\"),this.drawRect(null,\\\"end\\\"),this.drawText(null,\\\"end\\\"),this.drawImage(null,\\\"end\\\"),this.onDrawn();const e=Math.round(performance.now()/1e3);e!==this.lastFullSecond&&(this.lastFullSecond=e,this.countSinceLastFullSecond=0),this.countSinceLastFullSecond++}drawNodeAndChildren(t,e,s){if(\\\"clippath\\\"===t.type&&!s)return;const r=this.ctx,i=Object.assign({},this.parentValues);s||r.save();this.applyTransform(t.transform);if((t.transform||s)&&(e=!0),t[\\\"clip-path\\\"])if(\\\"url(#\\\"===t[\\\"clip-path\\\"].substr(0,5)){const s=t[\\\"clip-path\\\"].substr(5,t[\\\"clip-path\\\"].length-6),i=this.vdom.getNodeById(s);if(e=!0,i){const t=new Path2D;this.drawNodeAndChildren(i,e,t),r.clip(t)}else;}else!function(...t){o<50&&(o++,console.error(...t))}(\\\"clip path format not supported:\\\",t[\\\"clip-path\\\"]);t.style.display&&\\\"none\\\"===t.style.display||(e?this.drawSingleNode(t,\\\"forcesingle\\\",s):this.drawSingleNode(t,\\\"normal\\\",s));const l=this.getFillStyle(t,\\\"undefined\\\");\\\"undefined\\\"!==l&&(this.parentValues.fill=l);const n=this.getStrokeStyle(t,\\\"undefined\\\");if(\\\"undefined\\\"!==n&&(this.parentValues.stroke=n),this.parentValues.opacity=t.opacity,t.children)for(let r=0;r<t.children.length;r++)this.drawNodeAndChildren(t.children[r],e,s);s||(r.restore(),this.parentValues=i)}drawSingleNode(t,e=\\\"normal\\\",s){const r=t.type,i=this[\\\"draw\\\"+r.substr(0,1).toUpperCase()+r.substr(1)];if(!i)return console.error(\\\"no draw function yet for \\\",r);i.call(this,t,e,s)}drawClippath(t){}drawSvg(){}drawTitle(){}drawG(){}drawCircle(t,e=\\\"normal\\\",s){if(\\\"normal\\\"===e){const e=this.getFillStyle(t,\\\"#000\\\")+\\\";\\\"+this.getStrokeStyle(t);this.circlesByColor[e]||(this.circlesByColor[e]=[]),this.circlesByColor[e].push(t)}if(\\\"start\\\"!==e){if(\\\"end\\\"!==e){if(\\\"forcesingle\\\"===e){let e=this.getFillStyle(t,\\\"#000\\\");const r=this.vdom.get(t,\\\"cx\\\")||0,i=this.vdom.get(t,\\\"cy\\\")||0;this.ctx.beginPath(),this.ctx.fillStyle=e,this.ctx.strokeStyle=this.getStrokeStyle(t),this.ctx.lineWidth=this.getStrokeWidth(t),this.ctx.moveTo(r+t.r,i),(s||this.ctx).arc(r,i,t.r,0,2*Math.PI),\\\"none\\\"===e||s||this.ctx.fill(),t.style[\\\"stroke-rgba\\\"]&&\\\"none\\\"!==t.style[\\\"stroke-rgba\\\"]&&!s&&this.ctx.stroke()}}else for(let t in this.circlesByColor)if(this.circlesByColor.hasOwnProperty(t)){const e=t.split(\\\";\\\"),s=e[0],r=e[1];this.ctx.fillStyle=s;let i=this.circlesByColor[t][0];const o=this.getStrokeWidth(i);this.ctx.lineWidth=void 0!==o?o:1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.circlesByColor[t]){const t=this.vdom.get(e,\\\"cx\\\")?this.vdom.get(e,\\\"cx\\\"):0,s=this.vdom.get(e,\\\"cy\\\")?this.vdom.get(e,\\\"cy\\\"):0,r=this.vdom.get(e,\\\"r\\\");this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t+r,s),this.ctx.arc(t,s,r,0,2*Math.PI),this.ctx.restore()}\\\"none\\\"!==s&&this.ctx.fill(),i.style[\\\"stroke-rgba\\\"]&&\\\"none\\\"!==i.style[\\\"stroke-rgba\\\"]&&this.ctx.stroke()}}else this.circlesByColor={}}getFillStyle(t,e=\\\"none\\\"){let s=t.style.fill?t.style.fill:t.fill,r=t.opacity||1;if(t.style.opacity&&(r=parseFloat(t.style.opacity)),t[\\\"fill-opacity\\\"]||t.style[\\\"fill-opacity\\\"]){r*=t[\\\"fill-opacity\\\"]?parseFloat(t[\\\"fill-opacity\\\"]):parseFloat(t.style[\\\"fill-opacity\\\"])}let o=\\\"\\\";return this.parentValues.fill&&(o=this.parentValues.fill),this.parentValues[\\\"style;fill\\\"]&&(o=this.parentValues[\\\"style;fill\\\"]),this.parentValues.fill||this.parentValues[\\\"style;fill\\\"]||(o=e),s=i.default.colorToRgba(s,r,o),s}getStrokeStyle(t,e=\\\"none\\\"){if(t.style[\\\"stroke-rgba\\\"])return t.style[\\\"stroke-rgba\\\"];let s=t.style.stroke?t.style.stroke:t.stroke;if(void 0!==s){let e=void 0===t.style[\\\"stroke-opacity\\\"]?t.style.opacity:t.style[\\\"stroke-opacity\\\"];return void 0===e&&(e=void 0===t[\\\"stroke-opacity\\\"]?t.opacity:t[\\\"stroke-opacity\\\"]),t.style[\\\"stroke-rgba\\\"]=i.default.colorToRgba(s,e),t.style[\\\"stroke-rgba\\\"]}return e}getStrokeWidth(t){const e=void 0!==t.style[\\\"stroke-width\\\"]?t.style[\\\"stroke-width\\\"]:t[\\\"stroke-width\\\"];return void 0===e?void 0:parseFloat(e)}drawRect(t,e=\\\"normal\\\",s){if(\\\"normal\\\"===e){const e=this.getFillStyle(t,\\\"#000\\\")+\\\";\\\"+this.getStrokeStyle(t);this.rectsByColor[e]||(this.rectsByColor[e]=[]),this.rectsByColor[e].push(t)}if(\\\"start\\\"!==e){if(\\\"end\\\"!==e){if(\\\"forcesingle\\\"===e){let e=this.getFillStyle(t,\\\"#000\\\");const r=this.getStrokeStyle(t),i=this.vdom.get(t,\\\"x\\\")||0,o=this.vdom.get(t,\\\"y\\\")||0;e&&\\\"none\\\"!==e&&!s&&(this.ctx.fillStyle=e,this.ctx.fillRect(i,o,t.width,t.height)),s&&s.rect(i,o,t.width,t.height),void 0===r||s||(this.ctx.strokeStyle=r,this.ctx.beginPath(),this.ctx.rect(i,o,t.width,t.height),this.ctx.stroke())}}else for(let t in this.rectsByColor)if(this.rectsByColor.hasOwnProperty(t)){const e=t.split(\\\";\\\"),s=e[0],r=e[1];this.ctx.fillStyle=s;let i=this.rectsByColor[t][0];const o=this.getStrokeWidth(i);this.ctx.lineWidth=void 0!==o?o:1,this.ctx.strokeStyle=r,this.ctx.beginPath();for(let e of this.rectsByColor[t]){const t=this.vdom.get(e,\\\"x\\\")||0,s=this.vdom.get(e,\\\"y\\\")||0;this.ctx.save(),this.applyTransform(e.transform),this.ctx.moveTo(t,s),this.ctx.rect(t,s,e.width,e.height),this.ctx.restore()}\\\"none\\\"!==s&&this.ctx.fill(),i.style[\\\"stroke-rgba\\\"]&&\\\"none\\\"!==i.style[\\\"stroke-rgba\\\"]&&this.ctx.stroke()}}else this.rectsByColor={}}drawText(t,e=\\\"normal\\\",s=!1){const r=t=>{if(\\\"\\\"===t.text)return;let e=\\\"Times New Roman\\\";t[\\\"font-family\\\"]&&(e=t[\\\"font-family\\\"]),t.style[\\\"font-family\\\"]&&(e=t.style[\\\"font-family\\\"]);let s=\\\"16px\\\";t[\\\"font-size\\\"]&&(s=i.default.convertSizeToPx(t[\\\"font-size\\\"])+\\\"px\\\"),t.style[\\\"font-size\\\"]&&(s=i.default.convertSizeToPx(t.style[\\\"font-size\\\"])+\\\"px\\\");let r=t.style.font?t.style.font:t.font;r||(r=s+\\\" \\\"+e);let o=void 0!==t[\\\"text-anchor\\\"]?t[\\\"text-anchor\\\"]:t.style[\\\"text-anchor\\\"];o&&(\\\"middle\\\"===o&&(o=\\\"center\\\"),this.ctx.textAlign=o);let l=t.fill?t.fill:t.style.fill;l||(l=\\\"#000\\\"),this.ctx.font=r,this.ctx.fillStyle=l;let n=this.vdom.get(t,\\\"x\\\")||0,a=this.vdom.get(t,\\\"y\\\")||0,c=i.default.convertSizeToPx(t.dx,!1)||0,h=i.default.convertSizeToPx(t.dy,!1)||0;this.ctx.fillText(t.text,n+c,a+h)};if(\\\"start\\\"!==e)if(\\\"normal\\\"!==e){if(\\\"forcesingle\\\"===e)return r(t);if(\\\"end\\\"!==e);else for(const t of this.drawTexts)r(t)}else this.drawTexts.push(t);else this.drawTexts=[]}drawImage(t,e=\\\"normal\\\"){const s=t=>{if(\\\"\\\"===t.href)return;let e=t.fill?t.fill:t.style.fill;e||(e=\\\"#000\\\"),this.ctx.fillStyle=e;let s=this.vdom.get(t,\\\"x\\\")||0,r=this.vdom.get(t,\\\"y\\\")||0,i=t.width||0,o=t.height||0;if(t.image)try{this.ctx.drawImage(t.image,s,r,i,o)}catch(t){console.log(t)}};if(\\\"start\\\"!==e)if(\\\"normal\\\"!==e){if(\\\"forcesingle\\\"===e)return s(t);if(\\\"end\\\"!==e);else for(const t of this.drawImages)s(t)}else this.drawImages.push(t);else this.drawImages=[]}drawPath(t,e=\\\"normal\\\",s){if(\\\"normal\\\"!==e&&\\\"forcesingle\\\"!==e)return;const r=this.getFillStyle(t,\\\"#000\\\"),i=this.getStrokeStyle(t),o=this.getStrokeWidth(t);let l=new Path2D(t.d);if(this.ctx.fillStyle=r,void 0!==i&&\\\"none\\\"!==i){if(void 0!==o&&(this.ctx.lineWidth=o),this.ctx.strokeStyle=i,t.style[\\\"stroke-linejoin\\\"]){const e=t.style[\\\"stroke-linejoin\\\"];\\\"bevel\\\"===e||\\\"round\\\"===e||\\\"miter\\\"===e?this.ctx.lineJoin=e:console.error(\\\"unknown line join value:\\\",e)}s||this.ctx.stroke(l)}r&&\\\"none\\\"!==r&&!s&&this.ctx.fill(l),s&&s.addPath(l)}drawTspan(t,e=\\\"normal\\\"){if(\\\"normal\\\"!==e&&\\\"forcesingle\\\"!==e)return;this.ctx.font=\\\"10px Arial\\\",this.ctx.fillStyle=\\\"#000000\\\";const s=\\\"middle\\\"===t.style.textAnchor?\\\"center\\\":t.style.textAnchor;this.ctx.textAlign=s,this.ctx.fillText(t.text,this.vdom.get(t,\\\"x\\\"),this.vdom.get(t,\\\"y\\\"))}drawTextpath(t){console.warn(\\\"no draw function yet for textpath\\\")}drawLine(t,e=\\\"normal\\\"){if(this.vdom.data.scale,\\\"normal\\\"===e){const e=this.getStrokeStyle(t),s=this.getStrokeWidth(t);if(\\\"none\\\"===e||0===s)return;const r=`${e};${s}`;this.linesByColor[r]||(this.linesByColor[r]=[]),this.linesByColor[r].push(t)}if(\\\"start\\\"!==e){if(\\\"end\\\"!==e)\\\"forcesingle\\\"===e&&(this.ctx.beginPath(),this.ctx.moveTo(this.vdom.get(t,\\\"x1\\\")||0,this.vdom.get(t,\\\"y1\\\")||0),this.ctx.lineTo(this.vdom.get(t,\\\"x2\\\")||0,this.vdom.get(t,\\\"y2\\\")||0),this.ctx.strokeStyle=this.getStrokeStyle(t),this.ctx.lineWidth=this.getStrokeWidth(t),this.ctx.stroke());else for(let t in this.linesByColor)if(this.linesByColor.hasOwnProperty(t)){const e=t.split(\\\";\\\"),s=e[0],r=e[1];this.ctx.strokeStyle=s,this.ctx.lineWidth=parseFloat(r),this.ctx.beginPath();for(let e of this.linesByColor[t])e.transform&&(this.ctx.save(),this.applyTransform(e.transform)),this.ctx.moveTo(this.vdom.get(e,\\\"x1\\\")||0,this.vdom.get(e,\\\"y1\\\")||0),this.ctx.lineTo(this.vdom.get(e,\\\"x2\\\")||0,this.vdom.get(e,\\\"y2\\\")||0),e.transform&&this.ctx.restore();this.ctx.stroke()}}else this.linesByColor={}}drawDefs(t){}drawMarker(t){}applyTransform(t){const e=t?i.default.parseTransform(t):null;if(e){e.rotate,this.ctx.rotate(e.rotate*Math.PI/180);const t=e.translateBeforeScale?e.translateX:e.translateX*e.scaleX,s=e.translateBeforeScale?e.translateY:e.translateY*e.scaleY;return this.ctx.transform(e.scaleX,0,0,e.scaleY,t,s),!0}return!1}};let o=0}]);\\n//# sourceMappingURL=cac638e1893cf9be45e5.worker.js.map\", __webpack_public_path__ + \"cac638e1893cf9be45e5.worker.js\");\n};","'use strict';\n\n// http://stackoverflow.com/questions/10343913/how-to-create-a-web-worker-from-a-string\n\nvar URL = window.URL || window.webkitURL;\n\nmodule.exports = function (content, url) {\n  try {\n    try {\n      var blob;\n\n      try {\n        // BlobBuilder = Deprecated, but widely implemented\n        var BlobBuilder = window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder;\n\n        blob = new BlobBuilder();\n\n        blob.append(content);\n\n        blob = blob.getBlob();\n      } catch (e) {\n        // The proposed API\n        blob = new Blob([content]);\n      }\n\n      return new Worker(URL.createObjectURL(blob));\n    } catch (e) {\n      return new Worker('data:application/javascript,' + encodeURIComponent(content));\n    }\n  } catch (e) {\n    if (!url) {\n      throw Error('Inline worker is not supported');\n    }\n\n    return new Worker(url);\n  }\n};"],"sourceRoot":""}